!function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){i(1),i(13),i(19),t.exports=i(30)},function(t,e,i){(function(t){t.xBinaryReader=t.xBinaryReader?t.xBinaryReader:i(2).xBinaryReader,t.xModelGeometry=t.xModelGeometry?t.xModelGeometry:i(3).xModelGeometry,t.xModelHandle=t.xModelHandle?t.xModelHandle:i(7).xModelHandle,t.xProductInheritance=t.xProductInheritance?t.xProductInheritance:i(8).xProductInheritance,t.xProductType=t.xProductType?t.xProductType:i(5).xProductType,t.xShaders=t.xShaders?t.xShaders:i(9).xShaders,t.xState=t.xState?t.xState:i(4).xState,t.xTriangulatedShape=t.xTriangulatedShape?t.xTriangulatedShape:i(6).xTriangulatedShape,t.xViewer=t.xViewer?t.xViewer:i(10).xViewer}).call(e,function(){return this}())},function(t,e){"use strict";var i=function(){function t(){this._buffer=null,this._position=0}return t.prototype.onloaded=function(){},t.prototype.onerror=function(t){},t.prototype.load=function(t){this._position=0;var e=this;if("undefined"==typeof t||null==t)throw"Source must be defined";if("string"==typeof t){var i;i=new XMLHttpRequest,i.open("GET",t,!0),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var t=new FileReader;t.onloadend=function(){t.result&&(e._buffer=t.result,e.onloaded&&e.onloaded())},t.readAsArrayBuffer(i.response)}if(4==i.readyState&&200!=i.status){var r="Failed to fetch binary data from server. Server code: "+i.status+". This might be due to CORS policy of your browser if you run this as a local file.";throw e.onerror&&e.onerror(r),r}},i.responseType="blob",i.send()}else if(t instanceof Blob||t instanceof File){var r=new FileReader;r.onloadend=function(){r.result&&(e._buffer=r.result,e.onloaded&&e.onloaded())},r.readAsArrayBuffer(t)}else t instanceof ArrayBuffer&&(this._buffer=t)},t.prototype.getIsEOF=function(t,e){if("undefined"==typeof this._position)throw"Position is not defined";return this._position==this._buffer.byteLength},t.prototype.read=function(t,e,i){"undefined"==typeof e&&(e=1);var r=t*e,n=this._position;this._position+=r;return 1===e?new i(this._buffer.slice(n,n+r))[0]:new i(this._buffer.slice(n,n+r))},t.prototype.readByte=function(t){return this.read(1,t,Uint8Array)},t.prototype.readUint8=function(t){return this.read(1,t,Uint8Array)},t.prototype.readInt16=function(t){return this.read(2,t,Int16Array)},t.prototype.readUint16=function(t){return this.read(2,t,Uint16Array)},t.prototype.readInt32=function(t){return this.read(4,t,Int32Array)},t.prototype.readUint32=function(t){return this.read(4,t,Uint32Array)},t.prototype.readFloat32=function(t){return this.read(4,t,Float32Array)},t.prototype.readFloat64=function(t){return this.read(8,t,Float64Array)},t.prototype.readChar=function(t){"undefined"==typeof t&&(t=1);var e=this.readByte(t),i=new Array(t);for(var r in e)i[r]=String.fromCharCode(e[r]);return 1===t?i[0]:i},t.prototype.readPoint=function(t){"undefined"==typeof t&&(t=1);for(var e=this.readFloat32(3*t),i=new Array(t),r=0;r<t;r++){var n=3*r*4,a=new Float32Array(e.buffer,n,3);i[r]=a}return 1===t?i[0]:i},t.prototype.readRgba=function(t){"undefined"==typeof t&&(t=1);for(var e=this.readByte(4*t),i=new Array(t),r=0;r<t;r++){var n=4*r,a=new Uint8Array(e.buffer,n,4);i[r]=a}return 1===t?i[0]:i},t.prototype.readPackedNormal=function(t){"undefined"==typeof t&&(t=1);for(var e=this.readUint8(2*t),i=new Array(t),r=0;r<t;r++){var n=new Uint8Array(e.buffer,2*r,2);i[r]=n}return 1===t?i[0]:i},t.prototype.readMatrix4x4=function(t){"undefined"==typeof t&&(t=1);for(var e=this.readFloat32(16*t),i=new Array(t),r=0;r<t;r++){var n=16*r*4,a=new Float32Array(e.buffer,n,16);i[r]=a}return 1===t?i[0]:i},t.prototype.readMatrix4x4_64=function(t){"undefined"==typeof t&&(t=1);for(var e=this.readFloat64(16*t),i=new Array(t),r=0;r<t;r++){var n=16*r*8,a=new Float64Array(e.buffer,n,16);i[r]=a}return 1===t?i[0]:i},t}();e.xBinaryReader=i},function(t,e,i){"use strict";var r=i(4),n=i(5),a=i(6),o=i(2),s=function(){function t(){this.meter=1e3,this.productMap={}}return t.prototype.parse=function(t){var e=t,i=e.readInt32();if(94132117!=i)throw"Magic number mismatch.";var o=e.readByte(),s=e.readInt32(),u=e.readInt32(),l=e.readInt32(),A=e.readInt32(),c=e.readInt32(),h=e.readInt32();this.meter=e.readFloat32();var f=e.readInt16(),d=function(t,e){if("undefined"==typeof t||"undefined"==typeof e)throw"Wrong arguments";if(0==e)return 0;for(var i=e*t,r=Math.ceil(Math.sqrt(i/4));4*r%t!=0;)r++;var n=r*r*4/t;return n};this.vertices=new Float32Array(d(4,3*u)),this.normals=new Uint8Array(6*l),this.indices=new Float32Array(3*l),this.styleIndices=new Uint16Array(3*l),this.styles=new Uint8Array(d(1,4*(h+1))),this.products=new Float32Array(3*l),this.states=new Uint8Array(3*l*2),this.transformations=new Float32Array(3*l),this.matrices=new Float32Array(d(4,16*A)),this.productMap={},this.regions=new Array(f);for(var p=0,m=0,g=3*l,v=0,T=0,I=r.xState,E=n.xProductType,C=0;C<f;C++)this.regions[C]={population:e.readInt32(),centre:e.readFloat32(3),bbox:e.readFloat32(6)};var y=[];y.getStyle=function(t){for(var e=0;e<this.length;e++){var i=this[e];if(i.id==t)return i}return null};var _=0;for(_;_<h;_++){var b=e.readInt32(),x=255*e.readFloat32(),S=255*e.readFloat32(),R=255*e.readFloat32(),M=255*e.readFloat32();this.styles.set([x,S,R,M],4*_),y.push({id:b,index:_,transparent:M<254})}this.styles.set([255,255,255,255],4*_);var F={id:-1,index:_,transparent:M<254};y.push(F);for(var C=0;C<c;C++){var B=e.readInt32(),P=e.readInt16(),O=e.readFloat32(6),w={productID:B,type:P,bBox:O,spans:[]};this.productMap[B]=w}for(var N=0;N<s;N++){for(var L=e.readInt32(),D=[],U=0;U<L;U++){var G=e.readInt32(),V=(e.readInt16(),e.readInt32()),b=e.readInt32(),H=null;L>1&&(H=1===o?e.readFloat32(16):e.readFloat64(16),this.matrices.set(H,T),T+=16);var k=y.getStyle(b);null===k&&(k=F),D.push({pLabel:G,iLabel:V,style:k.index,transparent:k.transparent,transform:null!=H?v++:65535})}var K=new a.xTriangulatedShape;K.parse(e),D.forEach(function(t){var e=0;e=t.transparent?g-K.indices.length:m;var i=e,r=this.productMap[t.pLabel];"undefined"==typeof r&&(r={productID:0,type:E.IFCOPENINGELEMENT,bBox:new Float32Array(6),spans:[]},this.productMap[t.pLabel]=r),this.normals.set(K.normals,2*e);for(var n=r.type==E.IFCSPACE||r.type==E.IFCOPENINGELEMENT?I.HIDDEN:255,a=0;a<K.indices.length;a++)this.indices[e]=K.indices[a]+p/3,this.products[e]=t.pLabel,this.styleIndices[e]=t.style,this.transformations[e]=t.transform,this.states[2*e]=n,this.states[2*e+1]=255,e++;var o=e;r.spans.push(new Int32Array([i,o])),t.transparent?g-=K.indices.length:m+=K.indices.length},this),this.vertices.set(K.vertices,p),p+=K.vertices.length,K=null}!e.getIsEOF(),this.transparentIndex=m},t.prototype.load=function(t){var e=new o.xBinaryReader,i=this;e.onloaded=function(){i.parse(e),i.onloaded&&i.onloaded()},e.onerror=function(t){i.onerror&&i.onerror(t)},e.load(t)},t.prototype.onloaded=function(){},t.prototype.onerror=function(t){},t}();e.xModelGeometry=s},function(t,e){"use strict";e.xState={UNDEFINED:255,HIDDEN:254,HIGHLIGHTED:253,XRAYVISIBLE:252,UNSTYLED:225}},function(t,e){"use strict";e.xProductType={IFCDISTRIBUTIONELEMENT:44,IFCDISTRIBUTIONFLOWELEMENT:45,IFCDISTRIBUTIONCHAMBERELEMENT:180,IFCENERGYCONVERSIONDEVICE:175,IFCAIRTOAIRHEATRECOVERY:1097,IFCBOILER:1105,IFCBURNER:1109,IFCCHILLER:1119,IFCCOIL:1124,IFCCONDENSER:1132,IFCCOOLEDBEAM:1141,IFCCOOLINGTOWER:1142,IFCENGINE:1164,IFCEVAPORATIVECOOLER:1166,IFCEVAPORATOR:1167,IFCHEATEXCHANGER:1187,IFCHUMIDIFIER:1188,IFCTUBEBUNDLE:1305,IFCUNITARYEQUIPMENT:1310,IFCELECTRICGENERATOR:1160,IFCELECTRICMOTOR:1161,IFCMOTORCONNECTION:1216,IFCSOLARDEVICE:1270,IFCTRANSFORMER:1303,IFCFLOWCONTROLLER:121,IFCELECTRICDISTRIBUTIONPOINT:242,IFCAIRTERMINALBOX:1096,IFCDAMPER:1148,IFCFLOWMETER:1182,IFCVALVE:1311,IFCELECTRICDISTRIBUTIONBOARD:1157,IFCELECTRICTIMECONTROL:1162,IFCPROTECTIVEDEVICE:1235,IFCSWITCHINGDEVICE:1290,IFCFLOWFITTING:467,IFCDUCTFITTING:1153,IFCPIPEFITTING:1222,IFCCABLECARRIERFITTING:1111,IFCCABLEFITTING:1113,IFCJUNCTIONBOX:1195,IFCFLOWMOVINGDEVICE:502,IFCCOMPRESSOR:1131,IFCFAN:1177,IFCPUMP:1238,IFCFLOWSEGMENT:574,IFCDUCTSEGMENT:1154,IFCPIPESEGMENT:1223,IFCCABLECARRIERSEGMENT:1112,IFCCABLESEGMENT:1115,IFCFLOWSTORAGEDEVICE:371,IFCTANK:1293,IFCELECTRICFLOWSTORAGEDEVICE:1159,IFCFLOWTERMINAL:46,IFCFIRESUPPRESSIONTERMINAL:1179,IFCSANITARYTERMINAL:1262,IFCSTACKTERMINAL:1277,IFCWASTETERMINAL:1315,IFCAIRTERMINAL:1095,IFCMEDICALDEVICE:1212,IFCSPACEHEATER:1272,IFCAUDIOVISUALAPPLIANCE:1099,IFCCOMMUNICATIONSAPPLIANCE:1127,IFCELECTRICAPPLIANCE:1156,IFCLAMP:1198,IFCLIGHTFIXTURE:1199,IFCOUTLET:1219,IFCFLOWTREATMENTDEVICE:425,IFCINTERCEPTOR:1193,IFCDUCTSILENCER:1155,IFCFILTER:1178,IFCDISTRIBUTIONCONTROLELEMENT:468,IFCPROTECTIVEDEVICETRIPPINGUNIT:1236,IFCACTUATOR:1091,IFCALARM:1098,IFCCONTROLLER:1139,IFCFLOWINSTRUMENT:1181,IFCSENSOR:1264,IFCUNITARYCONTROLELEMENT:1308,IFCDISCRETEACCESSORY:423,IFCFASTENER:535,IFCMECHANICALFASTENER:536,IFCREINFORCINGBAR:571,IFCREINFORCINGMESH:531,IFCTENDON:261,IFCTENDONANCHOR:675,IFCBUILDINGELEMENTPART:220,IFCVIBRATIONISOLATOR:1312,IFCCHAMFEREDGEFEATURE:765,IFCROUNDEDEDGEFEATURE:766,IFCOPENINGELEMENT:498,IFCOPENINGSTANDARDCASE:1217,IFCVOIDINGFEATURE:1313,IFCPROJECTIONELEMENT:384,IFCSURFACEFEATURE:1287,IFCFOOTING:120,IFCPILE:572,IFCBEAM:171,IFCBEAMSTANDARDCASE:1104,IFCCOLUMN:383,IFCCOLUMNSTANDARDCASE:1126,IFCCURTAINWALL:456,IFCDOOR:213,IFCDOORSTANDARDCASE:1151,IFCMEMBER:310,IFCMEMBERSTANDARDCASE:1214,IFCPLATE:351,IFCPLATESTANDARDCASE:1224,IFCRAILING:350,IFCRAMP:414,IFCRAMPFLIGHT:348,IFCROOF:347,IFCSLAB:99,IFCSLABELEMENTEDCASE:1268,IFCSLABSTANDARDCASE:1269,IFCSTAIR:346,IFCSTAIRFLIGHT:25,IFCWALL:452,IFCWALLSTANDARDCASE:453,IFCWALLELEMENTEDCASE:1314,IFCWINDOW:667,IFCWINDOWSTANDARDCASE:1316,IFCBUILDINGELEMENTPROXY:560,IFCCOVERING:382,IFCCHIMNEY:1120,IFCSHADINGDEVICE:1265,IFCELEMENTASSEMBLY:18,IFCFURNISHINGELEMENT:253,IFCFURNITURE:1184,IFCSYSTEMFURNITUREELEMENT:1291,IFCTRANSPORTELEMENT:416,IFCVIRTUALELEMENT:168,IFCELECTRICALELEMENT:23,IFCEQUIPMENTELEMENT:212,IFCCIVILELEMENT:1122,IFCGEOGRAPHICELEMENT:1185,IFCDISTRIBUTIONPORT:178,IFCPROXY:447,IFCSTRUCTURALLINEARACTION:463,IFCSTRUCTURALLINEARACTIONVARYING:464,IFCSTRUCTURALPLANARACTION:39,IFCSTRUCTURALPLANARACTIONVARYING:357,IFCSTRUCTURALPOINTACTION:356,IFCSTRUCTURALCURVEACTION:1279,IFCSTRUCTURALSURFACEACTION:1284,IFCSTRUCTURALPOINTREACTION:354,IFCSTRUCTURALCURVEREACTION:1280,IFCSTRUCTURALSURFACEREACTION:1285,IFCSTRUCTURALCURVECONNECTION:534,IFCSTRUCTURALPOINTCONNECTION:533,IFCSTRUCTURALSURFACECONNECTION:264,IFCSTRUCTURALCURVEMEMBER:224,IFCSTRUCTURALCURVEMEMBERVARYING:227,IFCSTRUCTURALSURFACEMEMBER:420,IFCSTRUCTURALSURFACEMEMBERVARYING:421,IFCANNOTATION:634,IFCBUILDING:169,IFCBUILDINGSTOREY:459,IFCSITE:349,IFCSPACE:454,IFCGRID:564,IFCEXTERNALSPATIALELEMENT:1174,IFCSPATIALZONE:1275}},function(t,e,i){"use strict";var r=i(2),n=function(){function t(){this.load=function(t){var e=new r.xBinaryReader,i=this;e.onloaded=function(){i.parse(e),i.onloaded&&i.onloaded()},e.load(t)},this.vertices=[]}return t.prototype.parse=function(t){var e=this,i=(t.readByte(),t.readInt32()),r=t.readInt32();e.vertices=t.readFloat32(3*i),e.indices=new Uint32Array(3*r),e.normals=new Uint8Array(6*r);var n,a=0;n=i<=255?function(e){return t.readByte(e)}:i<=65535?function(e){return t.readUint16(e)}:function(e){return t.readInt32(e)};var o=t.readInt32();if(0!==i&&0!==r)for(var s=0;s<o;s++){var u=t.readInt32();if(0!=u){var l=u>0;if(u=Math.abs(u),l){var A=t.readByte(2),c=n(3*u);e.indices.set(c,a);for(var h=0;h<3*u;h++)e.normals[2*a]=A[0],e.normals[2*a+1]=A[1],a++}else for(var h=0;h<u;h++)e.indices[a]=n(),e.normals.set(t.readByte(2),2*a),a++,e.indices[a]=n(),e.normals.set(t.readByte(2),2*a),a++,e.indices[a]=n(),e.normals.set(t.readByte(2),2*a),a++}}},t.prototype.onloaded=function(){},t}();e.xTriangulatedShape=n},function(t,e,i){"use strict";var r=i(4),n=function(){function t(e,i,r){if("undefined"==typeof e||"undefined"==typeof i||"undefined"==typeof r)throw"WebGL context and geometry model must be specified";this._gl=e,this._model=i,this._fpt=r,this.id=t._instancesNum++,this.stopped=!1,this.count=i.indices.length,this.vertexTexture=e.createTexture(),this.matrixTexture=e.createTexture(),this.styleTexture=e.createTexture(),this.stateStyleTexture=e.createTexture(),this.vertexTextureSize=0,this.matrixTextureSize=0,this.styleTextureSize=0,this.normalBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.productBuffer=e.createBuffer(),this.styleBuffer=e.createBuffer(),this.stateBuffer=e.createBuffer(),this.transformationBuffer=e.createBuffer(),this.stateStyle=new Uint8Array(900),this._feedCompleted=!1,this.region=i.regions[0],i.regions.forEach(function(t){t.population>this.region.population&&(this.region=t)},this),"undefined"==typeof this.region&&(this.region={population:1,centre:[0,0,0],bbox:[0,0,0,10*i.meter,10*i.meter,10*i.meter]})}return t.prototype.setActive=function(t){if(!this.stopped){var e=this._gl;this.vertexTextureSize>0&&(e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.vertexTexture)),this.matrixTextureSize>0&&(e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.matrixTexture)),this.styleTextureSize>0&&(e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,this.styleTexture)),e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.stateStyleTexture),e.bindBuffer(e.ARRAY_BUFFER,this.normalBuffer),e.vertexAttribPointer(t.normalAttrPointer,2,e.UNSIGNED_BYTE,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.indexBuffer),e.vertexAttribPointer(t.indexlAttrPointer,1,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.productBuffer),e.vertexAttribPointer(t.productAttrPointer,1,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.stateBuffer),e.vertexAttribPointer(t.stateAttrPointer,2,e.UNSIGNED_BYTE,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.styleBuffer),e.vertexAttribPointer(t.styleAttrPointer,1,e.UNSIGNED_SHORT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.transformationBuffer),e.vertexAttribPointer(t.transformationAttrPointer,1,e.FLOAT,!1,0,0),e.uniform1i(t.vertexSamplerUniform,1),e.uniform1i(t.matrixSamplerUniform,2),e.uniform1i(t.styleSamplerUniform,3),e.uniform1i(t.stateStyleSamplerUniform,4),e.uniform1i(t.vertexTextureSizeUniform,this.vertexTextureSize),e.uniform1i(t.matrixTextureSizeUniform,this.matrixTextureSize),e.uniform1i(t.styleTextureSizeUniform,this.styleTextureSize)}},t.prototype.draw=function(t){if(!this.stopped){var e=this._gl;return"undefined"==typeof t?void e.drawArrays(e.TRIANGLES,0,this.count):"solid"===t?void e.drawArrays(e.TRIANGLES,0,this._model.transparentIndex):"transparent"===t?void e.drawArrays(e.TRIANGLES,this._model.transparentIndex,this.count-this._model.transparentIndex):void 0}},t.prototype.drawProduct=function(t){if(!this.stopped){var e=this._gl,i=this.getProductMap(t);null!=i&&i.spans.forEach(function(t){e.drawArrays(e.TRIANGLES,t[0],t[1]-t[0])},this)}},t.prototype.getProductMap=function(t){var e=this._model.productMap[t];return"undefined"!=typeof e?e:null},t.prototype.unload=function(){var t=this._gl;t.deleteTexture(this.vertexTexture),t.deleteTexture(this.matrixTexture),t.deleteTexture(this.styleTexture),t.deleteTexture(this.stateStyleTexture),t.deleteBuffer(this.normalBuffer),t.deleteBuffer(this.indexBuffer),t.deleteBuffer(this.productBuffer),t.deleteBuffer(this.styleBuffer),t.deleteBuffer(this.stateBuffer),t.deleteBuffer(this.transformationBuffer)},t.prototype.feedGPU=function(){if(this._feedCompleted)throw"GPU can bee fed only once. It discards unnecessary data which cannot be restored again.";var t=(this._gl,this._model);this._bufferData(this.normalBuffer,t.normals),this._bufferData(this.indexBuffer,t.indices),this._bufferData(this.productBuffer,t.products),this._bufferData(this.stateBuffer,t.states),this._bufferData(this.transformationBuffer,t.transformations),this._bufferData(this.styleBuffer,t.styleIndices),this.vertexTextureSize=this._bufferTexture(this.vertexTexture,t.vertices,3),this.matrixTextureSize=this._bufferTexture(this.matrixTexture,t.matrices,4),this.styleTextureSize=this._bufferTexture(this.styleTexture,t.styles),this._bufferTexture(this.stateStyleTexture,this.stateStyle),t.normals=null,t.indices=null,t.products=null,t.transformations=null,t.styleIndices=null,t.vertices=null,t.matrices=null,this._feedCompleted=!0},t.prototype.refreshStyles=function(){this._bufferTexture(this.stateStyleTexture,this.stateStyle)},t.prototype._bufferData=function(t,e){var i=this._gl;i.bindBuffer(i.ARRAY_BUFFER,t),i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW)},t.prototype._bufferTexture=function(t,e,i){var r=this._gl;if(0==e.length)return 0;var n=this._fpt&&e instanceof Float32Array,a=0,o=r.getParameter(r.MAX_TEXTURE_SIZE);if(n)a=Math.ceil(Math.sqrt(Math.ceil(e.length/i)))+1;else{var s=Math.sqrt(e.byteLength/4);a=Math.ceil(s)}if(0==a)return 0;if(a>o)throw"Too much data! It cannot fit into the texture.";if(r.bindTexture(r.TEXTURE_2D,t),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,0),n){var u=null;a*a*i!=e.length?(u=new Float32Array(a*a*i),u.set(e)):u=e;var l=null;switch(i){case 1:l=r.ALPHA;break;case 3:l=r.RGB;break;case 4:l=r.RGBA}r.texImage2D(r.TEXTURE_2D,0,l,a,a,0,l,r.FLOAT,u)}else r.texImage2D(r.TEXTURE_2D,0,r.RGBA,a,a,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array(e.buffer));return r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),a},t.prototype.getState=function(t){if("undefined"==typeof t)throw"id must be defined";var e=this.getProductMap(t);if(null===e)return null;var i=e.spans[0];return"undefined"==typeof i?null:this._model.states[2*i[0]]},t.prototype.getStyle=function(t){if("undefined"==typeof t)throw"id must be defined";var e=this.getProductMap(t);if(null===e)return null;var i=e.spans[0];return"undefined"==typeof i?null:this._model.states[2*i[0]+1]},t.prototype.setState=function(t,e){if("number"!=typeof t&&t<0&&t>255)throw"You have to specify state as an ID of state or index in style pallete.";if("undefined"==typeof e)throw"You have to specify products as an array of product IDs or as a product type ID";var i=[];if("number"==typeof e)for(var r in this._model.productMap){var n=this._model.productMap[r];n.type==e&&i.push(n)}else for(var a=0;a<e.length;a++){var o=e[a],n=this.getProductMap(o);null!=n&&i.push(n)}var s=t<=225?1:0;i.forEach(function(e){e.spans.forEach(function(e){for(var i=e[0];i<e[1];i++)this._model.states[2*i+s]=t},this)},this),this._bufferData(this.stateBuffer,this._model.states)},t.prototype.resetStates=function(){for(var t=0;t<this._model.states.length;t+=2)this._model.states[t]=r.xState.UNDEFINED;this._bufferData(this.stateBuffer,this._model.states)},t.prototype.resetStyles=function(){for(var t=0;t<this._model.states.length;t+=2)this._model.states[t+1]=r.xState.UNSTYLED;this._bufferData(this.stateBuffer,this._model.states)},t.prototype.getModelState=function(){var t=[],e=this._model.productMap;for(var i in e)if(e.hasOwnProperty(i)){var r=e[i],n=r.spans[0];if("undefined"!=typeof n){var a=this._model.states[2*n[0]],o=this._model.states[2*n[0]+1];t.push([r.productID,a+(o<<8)])}}return t},t.prototype.restoreModelState=function(t){t.forEach(function(t){var e=t[0],i=t[1]>>8,r=t[1]-(i<<8),n=this.getProductMap(e);null!=n&&n.spans.forEach(function(t){for(var e=t[0];e<t[1];e++)this._model.states[2*e]=r,this._model.states[2*e+1]=i},this)},this),this._bufferData(this.stateBuffer,this._model.states)},t}();n._instancesNum=0,e.xModelHandle=n},function(t,e){"use strict";e.xProductInheritance={name:"IfcProduct",id:20,abs:!0,children:[{name:"IfcElement",id:19,abs:!0,children:[{name:"IfcDistributionElement",id:44,abs:!1,children:[{name:"IfcDistributionFlowElement",id:45,abs:!1,children:[{name:"IfcDistributionChamberElement",id:180,abs:!1},{name:"IfcEnergyConversionDevice",id:175,abs:!1,children:[{name:"IfcAirToAirHeatRecovery",id:1097,abs:!1},{name:"IfcBoiler",id:1105,abs:!1},{name:"IfcBurner",id:1109,abs:!1},{name:"IfcChiller",id:1119,abs:!1},{name:"IfcCoil",id:1124,abs:!1},{name:"IfcCondenser",id:1132,abs:!1},{name:"IfcCooledBeam",id:1141,abs:!1},{name:"IfcCoolingTower",id:1142,abs:!1},{name:"IfcEngine",id:1164,abs:!1},{name:"IfcEvaporativeCooler",id:1166,abs:!1},{name:"IfcEvaporator",id:1167,abs:!1},{name:"IfcHeatExchanger",id:1187,abs:!1},{name:"IfcHumidifier",id:1188,abs:!1},{name:"IfcTubeBundle",id:1305,abs:!1},{name:"IfcUnitaryEquipment",id:1310,abs:!1},{name:"IfcElectricGenerator",id:1160,abs:!1},{name:"IfcElectricMotor",id:1161,abs:!1},{name:"IfcMotorConnection",id:1216,abs:!1},{name:"IfcSolarDevice",id:1270,abs:!1},{name:"IfcTransformer",id:1303,abs:!1}]},{name:"IfcFlowController",id:121,abs:!1,children:[{name:"IfcElectricDistributionPoint",id:242,abs:!1},{name:"IfcAirTerminalBox",id:1096,abs:!1},{name:"IfcDamper",id:1148,abs:!1},{name:"IfcFlowMeter",id:1182,abs:!1},{name:"IfcValve",id:1311,abs:!1},{name:"IfcElectricDistributionBoard",id:1157,abs:!1},{name:"IfcElectricTimeControl",id:1162,abs:!1},{name:"IfcProtectiveDevice",id:1235,abs:!1},{name:"IfcSwitchingDevice",id:1290,abs:!1}]},{name:"IfcFlowFitting",id:467,abs:!1,children:[{name:"IfcDuctFitting",id:1153,abs:!1},{name:"IfcPipeFitting",id:1222,abs:!1},{name:"IfcCableCarrierFitting",id:1111,abs:!1},{name:"IfcCableFitting",id:1113,abs:!1},{name:"IfcJunctionBox",id:1195,abs:!1}]},{name:"IfcFlowMovingDevice",id:502,abs:!1,children:[{name:"IfcCompressor",id:1131,abs:!1},{name:"IfcFan",id:1177,abs:!1},{name:"IfcPump",id:1238,abs:!1}]},{name:"IfcFlowSegment",id:574,abs:!1,children:[{name:"IfcDuctSegment",id:1154,abs:!1},{name:"IfcPipeSegment",id:1223,abs:!1},{name:"IfcCableCarrierSegment",id:1112,abs:!1},{name:"IfcCableSegment",id:1115,abs:!1}]},{name:"IfcFlowStorageDevice",id:371,abs:!1,children:[{name:"IfcTank",id:1293,abs:!1},{name:"IfcElectricFlowStorageDevice",id:1159,abs:!1}]},{name:"IfcFlowTerminal",id:46,abs:!1,children:[{name:"IfcFireSuppressionTerminal",id:1179,abs:!1},{name:"IfcSanitaryTerminal",id:1262,abs:!1},{name:"IfcStackTerminal",id:1277,abs:!1},{name:"IfcWasteTerminal",id:1315,abs:!1},{name:"IfcAirTerminal",id:1095,abs:!1},{name:"IfcMedicalDevice",id:1212,abs:!1},{name:"IfcSpaceHeater",id:1272,abs:!1},{name:"IfcAudioVisualAppliance",id:1099,abs:!1},{name:"IfcCommunicationsAppliance",id:1127,abs:!1},{name:"IfcElectricAppliance",id:1156,abs:!1},{name:"IfcLamp",id:1198,abs:!1},{name:"IfcLightFixture",id:1199,abs:!1},{name:"IfcOutlet",id:1219,abs:!1}]},{name:"IfcFlowTreatmentDevice",id:425,abs:!1,children:[{name:"IfcInterceptor",id:1193,abs:!1},{name:"IfcDuctSilencer",id:1155,abs:!1},{name:"IfcFilter",id:1178,abs:!1}]}]},{name:"IfcDistributionControlElement",id:468,abs:!1,children:[{name:"IfcProtectiveDeviceTrippingUnit",id:1236,abs:!1},{name:"IfcActuator",id:1091,abs:!1},{name:"IfcAlarm",id:1098,abs:!1},{name:"IfcController",id:1139,abs:!1},{name:"IfcFlowInstrument",id:1181,abs:!1},{name:"IfcSensor",id:1264,abs:!1},{name:"IfcUnitaryControlElement",id:1308,abs:!1}]}]},{name:"IfcElementComponent",id:424,abs:!0,children:[{name:"IfcDiscreteAccessory",id:423,abs:!1},{name:"IfcFastener",id:535,abs:!1,children:[{name:"IfcMechanicalFastener",id:536,abs:!1}]},{name:"IfcReinforcingElement",id:262,abs:!0,children:[{name:"IfcReinforcingBar",id:571,abs:!1},{name:"IfcReinforcingMesh",id:531,abs:!1},{name:"IfcTendon",id:261,abs:!1},{name:"IfcTendonAnchor",id:675,abs:!1}]},{name:"IfcBuildingElementPart",id:220,abs:!1},{name:"IfcMechanicalFastener",id:536,abs:!1},{name:"IfcVibrationIsolator",id:1312,abs:!1}]},{name:"IfcFeatureElement",id:386,abs:!0,children:[{name:"IfcFeatureElementSubtraction",id:499,abs:!0,children:[{name:"IfcEdgeFeature",id:764,abs:!0,children:[{name:"IfcChamferEdgeFeature",id:765,abs:!1},{name:"IfcRoundedEdgeFeature",id:766,abs:!1}]},{name:"IfcOpeningElement",id:498,abs:!1,children:[{name:"IfcOpeningStandardCase",id:1217,abs:!1}]},{name:"IfcVoidingFeature",id:1313,abs:!1}]},{name:"IfcFeatureElementAddition",id:385,abs:!0,children:[{name:"IfcProjectionElement",id:384,abs:!1}]},{name:"IfcSurfaceFeature",id:1287,abs:!1}]},{name:"IfcBuildingElement",id:26,abs:!0,children:[{name:"IfcBuildingElementComponent",id:221,abs:!0,children:[{name:"IfcBuildingElementPart",id:220,abs:!1},{name:"IfcReinforcingElement",id:262,abs:!0,children:[{name:"IfcReinforcingBar",id:571,abs:!1},{name:"IfcReinforcingMesh",id:531,abs:!1},{name:"IfcTendon",id:261,abs:!1},{name:"IfcTendonAnchor",id:675,abs:!1}]}]},{name:"IfcFooting",id:120,abs:!1},{name:"IfcPile",id:572,abs:!1},{name:"IfcBeam",id:171,abs:!1,children:[{name:"IfcBeamStandardCase",id:1104,abs:!1}]},{name:"IfcColumn",id:383,abs:!1,children:[{name:"IfcColumnStandardCase",id:1126,abs:!1}]},{name:"IfcCurtainWall",id:456,abs:!1},{name:"IfcDoor",id:213,abs:!1,children:[{name:"IfcDoorStandardCase",id:1151,abs:!1}]},{name:"IfcMember",id:310,abs:!1,children:[{name:"IfcMemberStandardCase",id:1214,abs:!1}]},{name:"IfcPlate",id:351,abs:!1,children:[{name:"IfcPlateStandardCase",id:1224,abs:!1}]},{name:"IfcRailing",id:350,abs:!1},{name:"IfcRamp",id:414,abs:!1},{name:"IfcRampFlight",id:348,abs:!1},{name:"IfcRoof",id:347,abs:!1},{name:"IfcSlab",id:99,abs:!1,children:[{name:"IfcSlabElementedCase",id:1268,abs:!1},{name:"IfcSlabStandardCase",id:1269,abs:!1}]},{name:"IfcStair",id:346,abs:!1},{name:"IfcStairFlight",id:25,abs:!1},{name:"IfcWall",id:452,abs:!1,children:[{name:"IfcWallStandardCase",id:453,abs:!1},{name:"IfcWallElementedCase",id:1314,abs:!1}]},{name:"IfcWindow",id:667,abs:!1,children:[{name:"IfcWindowStandardCase",id:1316,abs:!1}]},{name:"IfcBuildingElementProxy",id:560,abs:!1},{name:"IfcCovering",id:382,abs:!1},{name:"IfcChimney",id:1120,abs:!1},{name:"IfcShadingDevice",id:1265,abs:!1}]},{name:"IfcElementAssembly",id:18,abs:!1},{name:"IfcFurnishingElement",id:253,abs:!1,children:[{name:"IfcFurniture",id:1184,abs:!1},{name:"IfcSystemFurnitureElement",id:1291,abs:!1}]},{name:"IfcTransportElement",id:416,abs:!1},{name:"IfcVirtualElement",id:168,abs:!1},{name:"IfcElectricalElement",id:23,abs:!1},{name:"IfcEquipmentElement",id:212,abs:!1},{name:"IfcCivilElement",id:1122,abs:!1},{name:"IfcGeographicElement",id:1185,abs:!1}]},{name:"IfcPort",id:179,abs:!0,children:[{name:"IfcDistributionPort",id:178,abs:!1}]},{name:"IfcProxy",id:447,abs:!1},{name:"IfcStructuralActivity",id:41,abs:!0,children:[{name:"IfcStructuralAction",id:40,abs:!0,children:[{name:"IfcStructuralLinearAction",id:463,abs:!1,children:[{name:"IfcStructuralLinearActionVarying",id:464,abs:!1}]},{name:"IfcStructuralPlanarAction",id:39,abs:!1,children:[{name:"IfcStructuralPlanarActionVarying",id:357,abs:!1}]},{name:"IfcStructuralPointAction",id:356,abs:!1},{name:"IfcStructuralCurveAction",id:1279,abs:!1,children:[{name:"IfcStructuralLinearAction",id:463,abs:!1}]},{name:"IfcStructuralSurfaceAction",id:1284,abs:!1,children:[{name:"IfcStructuralPlanarAction",id:39,abs:!1}]}]},{name:"IfcStructuralReaction",id:355,abs:!0,children:[{name:"IfcStructuralPointReaction",id:354,abs:!1},{name:"IfcStructuralCurveReaction",id:1280,abs:!1},{name:"IfcStructuralSurfaceReaction",id:1285,abs:!1}]}]},{name:"IfcStructuralItem",id:226,abs:!0,children:[{name:"IfcStructuralConnection",id:265,abs:!0,children:[{name:"IfcStructuralCurveConnection",id:534,abs:!1},{name:"IfcStructuralPointConnection",id:533,abs:!1},{name:"IfcStructuralSurfaceConnection",id:264,abs:!1}]},{name:"IfcStructuralMember",id:225,abs:!0,children:[{name:"IfcStructuralCurveMember",id:224,abs:!1,children:[{name:"IfcStructuralCurveMemberVarying",id:227,abs:!1}]},{name:"IfcStructuralSurfaceMember",id:420,abs:!1,children:[{name:"IfcStructuralSurfaceMemberVarying",id:421,abs:!1}]}]}]},{name:"IfcAnnotation",id:634,abs:!1},{name:"IfcSpatialStructureElement",id:170,abs:!0,children:[{name:"IfcBuilding",id:169,abs:!1},{name:"IfcBuildingStorey",id:459,abs:!1},{name:"IfcSite",id:349,abs:!1},{name:"IfcSpace",id:454,abs:!1}]},{name:"IfcGrid",id:564,abs:!1},{name:"IfcSpatialElement",id:1273,abs:!0,children:[{name:"IfcSpatialStructureElement",id:170,abs:!0,children:[{name:"IfcBuilding",id:169,abs:!1},{name:"IfcBuildingStorey",id:459,abs:!1},{name:"IfcSite",id:349,abs:!1},{name:"IfcSpace",id:454,abs:!1}]},{name:"IfcExternalSpatialStructureElement",id:1175,abs:!0,children:[{name:"IfcExternalSpatialElement",id:1174,abs:!1}]},{name:"IfcSpatialZone",id:1275,abs:!1}]}]}},function(t,e){"use strict";e.xShaders={fragment_shader:" precision mediump float; uniform vec4 uClippingPlane; varying vec4 vFrontColor; varying vec4 vBackColor; varying vec3 vPosition; varying float vDiscard; void main(void) { if ( vDiscard > 0.001) discard; if (length(uClippingPlane) > 0.001) { vec4 p = uClippingPlane; vec3 x = vPosition; float distance = (dot(p.xyz, x) + p.w) / length(p.xyz); if (distance < 0.0){ discard; } } gl_FragColor = gl_FrontFacing ? vFrontColor : vBackColor; }",vertex_shader:" attribute highp float aVertexIndex; attribute highp float aTransformationIndex; attribute highp float aStyleIndex; attribute highp float aProduct; attribute highp vec2 aState; attribute highp vec2 aNormal; uniform mat4 uMVMatrix; uniform mat4 uPMatrix; uniform vec4 ulightA; uniform vec4 ulightB; uniform vec4 uHighlightColour; uniform float uMeter; uniform bool uColorCoding; uniform int uRenderingMode; uniform highp sampler2D uVertexSampler; uniform int uVertexTextureSize; uniform highp sampler2D uMatrixSampler; uniform int uMatrixTextureSize; uniform highp sampler2D uStyleSampler; uniform int uStyleTextureSize; uniform highp sampler2D uStateStyleSampler; varying vec4 vFrontColor; varying vec4 vBackColor; varying vec3 vPosition; varying float vDiscard; vec3 getNormal(){ float U = aNormal[0]; float V = aNormal[1]; float PI = 3.1415926535897932384626433832795; float lon = U / 252.0 * 2.0 * PI; float lat = V / 252.0 * PI; float x = sin(lon) * sin(lat); float z = cos(lon) * sin(lat); float y = cos(lat); return normalize(vec3(x, y, z)); } vec4 getIdColor(){ float product = floor(aProduct + 0.5); float B = floor (product/(256.0*256.0)); float G = floor((product  - B * 256.0*256.0)/256.0); float R = mod(product, 256.0); return vec4(R/255.0, G/255.0, B/255.0, 1.0); } vec2 getTextureCoordinates(int index, int size) { float x = float(index - (index / size) * size); float y = float(index / size); float pixelSize = 1.0 / float(size); return vec2((x + 0.5) * pixelSize, (y + 0.5) * pixelSize); } vec4 getColor(){ int restyle = int(floor(aState[1] + 0.5)); if (restyle > 224){ int index = int (floor(aStyleIndex + 0.5)); vec2 coords = getTextureCoordinates(index, uStyleTextureSize); return texture2D(uStyleSampler, coords); } vec2 coords = getTextureCoordinates(restyle, 15); return texture2D(uStateStyleSampler, coords); } vec3 getVertexPosition(){ int index = int (floor(aVertexIndex +0.5)); vec2 coords = getTextureCoordinates(index, uVertexTextureSize); vec3 point = vec3(texture2D(uVertexSampler, coords)); int tIndex = int(floor(aTransformationIndex + 0.5)); if (tIndex != 65535) { tIndex *=4; mat4 transform = mat4( texture2D(uMatrixSampler, getTextureCoordinates(tIndex, uMatrixTextureSize)), texture2D(uMatrixSampler, getTextureCoordinates(tIndex+1, uMatrixTextureSize)), texture2D(uMatrixSampler, getTextureCoordinates(tIndex+2, uMatrixTextureSize)), texture2D(uMatrixSampler, getTextureCoordinates(tIndex+3, uMatrixTextureSize)) ); return vec3(transform * vec4(point, 1.0)); } return point; } void main(void) { int state = int(floor(aState[0] + 0.5)); vDiscard = 0.0; if (state == 254) { vDiscard = 1.0; vFrontColor = vec4(0.0, 0.0, 0.0, 0.0); vBackColor = vec4(0.0, 0.0, 0.0, 0.0); vPosition = vec3(0.0, 0.0, 0.0); gl_Position = vec4(0.0, 0.0, 0.0, 1.0); return; } vec3 vertex = getVertexPosition(); vec3 normal = getNormal(); vec3 backNormal = normal * -1.0; if (uColorCoding){ vec4 idColor = getIdColor(); vFrontColor = idColor; vBackColor = idColor; } else{ float lightAIntensity = ulightA[3]; vec3 lightADirection = normalize(ulightA.xyz - vertex); float lightBIntensity = ulightB[3]; vec3 lightBDirection = normalize(ulightB.xyz - vertex); float lightWeightA = max(dot(normal, lightADirection ) * lightAIntensity, 0.0); float lightWeightB = max(dot(normal, lightBDirection ) * lightBIntensity, 0.0); float backLightWeightA = max(dot(backNormal, lightADirection) * lightAIntensity, 0.0); float backLightWeightB = max(dot(backNormal, lightBDirection) * lightBIntensity, 0.0); float lightWeighting = lightWeightA + lightWeightB + 0.4; float backLightWeighting = backLightWeightA + backLightWeightB + 0.4; vec4 baseColor = vec4(1.0, 1.0, 1.0, 1.0); if (uRenderingMode == 2){ if (state == 252){ baseColor = getColor(); } else{ baseColor = vec4(0.0, 0.0, 0.3, 0.5); } } if (state == 253) { baseColor = uHighlightColour; } if (uRenderingMode != 2 && state != 253){ baseColor = getColor(); } if (baseColor.a < 0.98 && uRenderingMode == 0) { vec3 trans = -0.002 * uMeter * normalize(normal); vertex = vertex + trans; } vFrontColor = vec4(baseColor.rgb * lightWeighting, baseColor.a); vBackColor = vec4(baseColor.rgb * backLightWeighting, baseColor.a); } vPosition = vertex; gl_Position = uPMatrix * uMVMatrix * vec4(vertex, 1.0); }",
vertex_shader_noFPT:" attribute highp float aVertexIndex; attribute highp float aTransformationIndex; attribute highp float aStyleIndex; attribute highp float aProduct; attribute highp float aState; attribute highp vec2 aNormal; uniform mat4 uMVMatrix; uniform mat4 uPMatrix; uniform vec4 ulightA; uniform vec4 ulightB; uniform bool uColorCoding; uniform bool uFloatingPoint; uniform highp sampler2D uVertexSampler; uniform int uVertexTextureSize; uniform highp sampler2D uMatrixSampler; uniform int uMatrixTextureSize; uniform highp sampler2D uStyleSampler; uniform int uStyleTextureSize; uniform highp sampler2D uStateStyleSampler; int stateStyleTextureSize = 15; varying vec4 vColor; varying vec3 vPosition; vec3 getNormal(){ float U = aNormal[0]; float V = aNormal[1]; float PI = 3.1415926535897932384626433832795; float u = ((U / 252.0) * (2.0 * PI)) - PI; float v = ((V / 252.0) * (2.0 * PI)) - PI; float x = sin(v) * cos(u); float y = sin(v) * sin(u); float z = cos(v); return normalize(vec3(x, y, z)); } vec4 getIdColor(){ float R = mod(aProduct, 256.0) / 255.0; float G = floor(aProduct/256.0) / 255.0; float B = floor (aProduct/(256.0*256.0)) / 255.0; return vec4(R, G, B, 1.0); } vec2 getVertexTextureCoordinates(int index, int size) { float x = float(index - (index / size) * size); float y = float(index / size); float pixelSize = 1.0 / float(size); return vec2((x + 0.5) * pixelSize, (y + 0.5) * pixelSize); } int getByteFromScale(float base) { float result = base * 255.0; int correction = fract(result) >= 0.5 ? 1 : 0; return int(result) + correction; } ivec4 getPixel(int index, sampler2D sampler, int size) { vec2 coords = getVertexTextureCoordinates(index, size); vec4 pixel = texture2D(sampler, coords); return ivec4( getByteFromScale(pixel.r), getByteFromScale(pixel.g), getByteFromScale(pixel.b), getByteFromScale(pixel.a) ); } void getBits(ivec4 pixel, out int result[32]) { for (int i = 0; i < 4; i++) { int actualByte = pixel[i]; for (int j = 0; j < 8; j++) { result[31 - (j + i * 8)] =  actualByte - (actualByte / 2) * 2; actualByte /= 2; } } } float getFloatFromPixel(ivec4 pixel) { int bits[32]; getBits(pixel, bits); float sign =  bits[0] == 0 ? 1.0 : -1.0; highp float fraction = 1.0; highp float exponent = 0.0; for (int i = 1; i < 9; i++) { exponent += float(bits[9 - i]) * exp2(float (i - 1)); } exponent -= 127.0; for (int i = 9; i < 32; i++) { fraction += float(bits[i]) * exp2(float((-1)*(i-8))); } return sign * fraction * exp2(exponent); } float getFloatFromPixel(int index, sampler2D sampler, int size) { ivec4 pixel = getPixel(index, sampler, size); return getFloatFromPixel(pixel); } vec4 getColor(){ if (floor(aState + 0.5) == 0.0){ int index = int (floor(aStyleIndex + 0.5)); vec2 coords = getVertexTextureCoordinates(index, uStyleTextureSize); return texture2D(uStyleSampler, coords); } else{ return vec4(1.0,1.0,1.0,1.0); } } vec3 getVertexPosition(){ int index = int (floor(aVertexIndex +0.5))* 3; vec3 position = vec3( getFloatFromPixel(index, uVertexSampler, uVertexTextureSize), getFloatFromPixel(index + 1, uVertexSampler, uVertexTextureSize), getFloatFromPixel(index + 2, uVertexSampler, uVertexTextureSize) ); int tIndex = int(floor(aTransformationIndex + 0.5)); if (tIndex != 65535) { tIndex *= 16; mat4 transform = mat4( getFloatFromPixel(tIndex + 0, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 1, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 2, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 3, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 4, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 5, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 6, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 7, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 8, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 9, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 10, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 11, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 12, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 13, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 14, uMatrixSampler, uMatrixTextureSize), getFloatFromPixel(tIndex + 15, uMatrixSampler, uMatrixTextureSize) ); vec4 transformedPosition = transform * vec4(position, 1.0); return vec3(transformedPosition); } return position; } void main(void) { vec3 vertex = getVertexPosition(); vPosition = vertex; gl_Position = uPMatrix * uMVMatrix * vec4(vertex, 1.0); if (uColorCoding){ vColor = getIdColor(); } else{ vec3 normal = getNormal(); float lightAIntensity = ulightA[3]; vec3 lightADirection = normalize(ulightA.xyz - vPosition); float lightBIntensity = ulightB[3]; vec3 lightBDirection = normalize(ulightB.xyz - vPosition); float lightWeightA = max(dot(normal, lightADirection ) * lightAIntensity, 0.0); float lightWeightB = max(dot(normal, lightBDirection ) * lightBIntensity, 0.0); float lightWeighting = lightWeightA + lightWeightB + 0.4; vec4 baseColor = getColor(); vColor = vec4(baseColor.rgb * lightWeighting, baseColor.a); } }"}},function(t,e,i){"use strict";var r=i(4),n=i(5),a=i(3),o=i(7),s=i(9),u=i(11);i(12);var l=function(){function t(t){if("undefined"==typeof t)throw"Canvas has to be defined";if("undefined"!=typeof t.nodeName&&"CANVAS"===t.nodeName&&(this._canvas=t),"string"==typeof t&&(this._canvas=document.getElementById(t)),null==this._canvas)throw"You have to specify canvas either as an ID of HTML element or the element itself";this.perspectiveCamera={fov:45,near:0,far:0},this.orthogonalCamera={left:0,right:0,top:0,bottom:0,near:0,far:0},this.camera="perspective",this.background=[230,230,230,255],this.highlightingColour=[255,173,33,255],this.lightA=[0,1e6,2e5,.8],this.lightB=[0,-5e5,5e4,.2],this.navigationMode="pan",this.renderingMode="normal",this.clippingPlane=[0,0,0,0],this._lastClippingPoint=[0,0,0];var e=WebGLUtils.setupWebGL(this._canvas);e&&(this._gl=e,this._fpt=e.getExtension("OES_texture_float")||e.getExtension("MOZ_OES_texture_float")||e.getExtension("WEBKIT_OES_texture_float"),e.enable(e.DEPTH_TEST),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND),this._width=this._canvas.width=this._canvas.offsetWidth,this._height=this._canvas.height=this._canvas.offsetHeight,this._geometryLoaded=!1,this._numberOfActiveModels=0,this._lastStates={},this._visualStateAttributes=["perspectiveCamera","orthogonalCamera","camera","background","lightA","lightB","renderingMode","clippingPlane","_mvMatrix","_pMatrix","_distance","_origin","highlightingColour","_numberOfActiveModels"],this._stylingChanged=!0,this._userAction=!0,this._events={},this._plugins=[],this._mvMatrixUniformPointer=null,this._pMatrixUniformPointer=null,this._lightAUniformPointer=null,this._lightBUniformPointer=null,this._colorCodingUniformPointer=null,this._clippingPlaneUniformPointer=null,this._meterUniformPointer=null,this._renderingModeUniformPointer=null,this._highlightingColourUniformPointer=null,this._mvMatrix=u.mat4.create(),this._pMatrix=u.mat4.create(),this._origin=[0,0,0],this._distance=0,this._shaderProgram=null,this._handles=[],this._stateStyles=new Uint8Array(900),this._isRunning=!0,this._initShaders(),this._initAttributesAndUniforms(),this._initMouseEvents(),this._initTouchNavigationEvents(),this._initTouchTapEvents())}return t.check=function(){var t={warnings:[],errors:[],noErrors:!1,noWarnings:!1},e=document.createElement("canvas");if(e){var i=WebGLUtils.setupWebGL(e);if(null==i)t.errors.push("Browser doesn't support WebGL. This is critical.");else{var r=i.getExtension("OES_texture_float")||i.getExtension("MOZ_OES_texture_float")||i.getExtension("WEBKIT_OES_texture_float");r||t.warnings.push("Floating point texture extension is not supported. Performance of the viewer will be very bad. But it should work.");var n=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS);n<4&&t.errors.push("Browser supports only "+n+" vertex texture image units but minimal requirement for the viewer is 4.")}}else t.errors.push("Browser doesn't have support for HTMLCanvasElement. This is critical.");return window.File&&window.FileReader&&window.Blob||t.errors.push("Browser doesn't support 'File', 'FileReader' or 'Blob' objects."),window.Int32Array&&window.Float32Array||t.errors.push("Browser doesn't support TypedArrays. These are crucial for binary parsing and for comunication with GPU."),document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")||t.warnings.push("Browser doesn't support SVG. This is used for user interaction like interactive clipping. Functions using SVG shouldn't crash but they won't work as expected."),0==t.errors.length&&(t.noErrors=!0),0==t.warnings.length&&(t.noWarnings=!0),t},t.prototype.addPlugin=function(t){this._plugins.push(t),t.init&&t.init(this)},t.prototype.removePlugin=function(t){var e=this._plugins.indexOf(t,0);e<0||this._plugins.splice(e,1)},t.prototype.defineStyle=function(t,e){if("undefined"==typeof t||t<0&&t>224)throw"Style index has to be defined as a number 0-224";if("undefined"==typeof e||!e.length||4!=e.length)throw"Colour must be defined as an array of 4 bytes";this._stylingChanged=!0;var i=new Uint8Array(e);this._stateStyles.set(i,4*t),this._handles.forEach(function(t){t.stateStyle=this._stateStyles,t.refreshStyles()},this)},t.prototype.setState=function(t,e){if("undefined"==typeof t||!(t>=225&&t<=255))throw"State has to be defined as 225 - 255. Use xState enum.";this._handles.forEach(function(i){i.setState(t,e)},this),this._stylingChanged=!0},t.prototype.getState=function(t){var e=null;return this._handles.forEach(function(i){e=i.getState(t),null!==e},this),e},t.prototype.resetStates=function(t){this._handles.forEach(function(t){t.resetStates()},this),t="undefined"==typeof t||t,t&&this._handles.forEach(function(t){t.setState(r.xState.HIDDEN,n.xProductType.IFCSPACE)},this),this._stylingChanged=!0},t.prototype.getModelState=function(t){var e=this._handles[t];if("undefined"==typeof e)throw"Model doesn't exist";return e.getModelState()},t.prototype.restoreModelState=function(t,e){var i=this._handles[t];if("undefined"==typeof i)throw"Model doesn't exist";i.restoreModelState(e),this._stylingChanged=!0},t.prototype.setStyle=function(t,e){if("undefined"==typeof t||!(t>=0&&t<=225))throw"Style has to be defined as 0 - 225 where 225 is for default style.";var i=[this._stateStyles[4*t],this._stateStyles[4*t+1],this._stateStyles[4*t+2],this._stateStyles[4*t+3]];0==i[0]&&0==i[1]&&0==i[2]&&0==i[3]&&console&&console.warn&&console.warn("You have used undefined colour for restyling. Elements with this style will have transparent black colour and hence will be invisible."),this._handles.forEach(function(i){i.setState(t,e)},this),this._stylingChanged=!0},t.prototype.getStyle=function(t){return this._handles.forEach(function(e){var i=e.getStyle(t);if(null!==i)return i},this),null},t.prototype.resetStyles=function(){this._handles.forEach(function(t){t.resetStyles()},this),this._stylingChanged=!0},t.prototype.getProductType=function(t){var e=null;return this._handles.forEach(function(i){var r=i.getProductMap(t);r&&(e=r.type)},this),e},t.prototype.setCameraPosition=function(t){if("undefined"==typeof t)throw"Parameter coordinates must be defined";u.mat4.lookAt(this._mvMatrix,t,this._origin,[0,0,1])},t.prototype.setCameraTarget=function(t){var e=this,i=function(t){var i=Math.max(t[3],t[4],t[5]),r=Math.max(e._width,e._height)/Math.min(e._width,e._height);e._distance=i/Math.tan(e.perspectiveCamera.fov*Math.PI/180)*r*1};if("undefined"!=typeof t&&null!=t){var r=null;return this._handles.every(function(e){var i=e.getProductMap(t);return!i||(r=i.bBox,!1)}),!!r&&(this._origin=[r[0]+r[3]/2,r[1]+r[4]/2,r[2]+r[5]/2],i(r),!0)}var n=this._handles[0];if(n){var a=n.region;a&&(this._origin=[a.centre[0],a.centre[1],a.centre[2]],i(a.bbox))}return!0},t.prototype.set=function(t){for(var e in t)this[e]=t[e]},t.prototype.load=function(t,e){if("undefined"==typeof t)throw"You have to specify model to load.";if("string"!=typeof t&&!(t instanceof Blob))throw"Model has to be specified either as a URL to wexBIM file or Blob object representing the wexBIM file.";var i=this,r=new a.xModelGeometry;r.onloaded=function(){i._addHandle(r,e)},r.onerror=function(t){i._error(t)},r.load(t)},t.prototype._addHandle=function(t,e){var i=this,r=this._gl,n=new o.xModelHandle(i._gl,t,null!=i._fpt);i._handles.push(n),n.stateStyle=i._stateStyles,n.feedGPU();var a=n._model.meter;if(r.uniform1f(i._meterUniformPointer,a),1===i._handles.length){i.setCameraTarget();var s=n.region,u=Math.max(s.bbox[3],s.bbox[4],s.bbox[5]);i.perspectiveCamera.far=50*u,i.perspectiveCamera.near=a/10,i.orthogonalCamera.far=i.perspectiveCamera.far,i.orthogonalCamera.near=i.perspectiveCamera.near;var l=1.8;i.orthogonalCamera.top=u/l,i.orthogonalCamera.bottom=u/l*-1,i.orthogonalCamera.left=u/l*-1*i._width/i._height,i.orthogonalCamera.right=u/l*i._width/i._height,i.setCameraTarget();var A=Math.sqrt(i._distance*i._distance/3);i.setCameraPosition([s.centre[0]+A*-1,s.centre[1]+A*-1,s.centre[2]+A])}i._fire("loaded",{id:n.id,tag:e}),i._geometryLoaded=!0},t.prototype.unload=function(t){var e=this._handles.filter(function(e){return e.id===t}).pop();if("undefined"==typeof e)throw"Model with id: "+t+" doesn't exist or was unloaded already.";e.stopped=!0;var i=this._handles.indexOf(e);this._handles.splice(i,1),this._numberOfActiveModels=this._handles.length,e.unload()},t.prototype._initShaders=function(){var t=this._gl,e=this,i=function(i,r){if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))return e._error(t.getShaderInfoLog(i)),null},r=t.createShader(t.FRAGMENT_SHADER);i(r,s.xShaders.fragment_shader);var n=t.createShader(t.VERTEX_SHADER);null!=this._fpt?i(n,s.xShaders.vertex_shader):i(n,s.xShaders.vertex_shader_noFPT),this._shaderProgram=t.createProgram(),t.attachShader(this._shaderProgram,n),t.attachShader(this._shaderProgram,r),t.linkProgram(this._shaderProgram),t.getProgramParameter(this._shaderProgram,t.LINK_STATUS)||this._error("Could not initialise shaders "),t.useProgram(this._shaderProgram)},t.prototype._initAttributesAndUniforms=function(){var t=this._gl;this._pMatrixUniformPointer=t.getUniformLocation(this._shaderProgram,"uPMatrix"),this._mvMatrixUniformPointer=t.getUniformLocation(this._shaderProgram,"uMVMatrix"),this._lightAUniformPointer=t.getUniformLocation(this._shaderProgram,"ulightA"),this._lightBUniformPointer=t.getUniformLocation(this._shaderProgram,"ulightB"),this._colorCodingUniformPointer=t.getUniformLocation(this._shaderProgram,"uColorCoding"),this._clippingPlaneUniformPointer=t.getUniformLocation(this._shaderProgram,"uClippingPlane"),this._meterUniformPointer=t.getUniformLocation(this._shaderProgram,"uMeter"),this._renderingModeUniformPointer=t.getUniformLocation(this._shaderProgram,"uRenderingMode"),this._highlightingColourUniformPointer=t.getUniformLocation(this._shaderProgram,"uHighlightColour"),this._pointers={normalAttrPointer:t.getAttribLocation(this._shaderProgram,"aNormal"),indexlAttrPointer:t.getAttribLocation(this._shaderProgram,"aVertexIndex"),productAttrPointer:t.getAttribLocation(this._shaderProgram,"aProduct"),stateAttrPointer:t.getAttribLocation(this._shaderProgram,"aState"),styleAttrPointer:t.getAttribLocation(this._shaderProgram,"aStyleIndex"),transformationAttrPointer:t.getAttribLocation(this._shaderProgram,"aTransformationIndex"),vertexSamplerUniform:t.getUniformLocation(this._shaderProgram,"uVertexSampler"),matrixSamplerUniform:t.getUniformLocation(this._shaderProgram,"uMatrixSampler"),styleSamplerUniform:t.getUniformLocation(this._shaderProgram,"uStyleSampler"),stateStyleSamplerUniform:t.getUniformLocation(this._shaderProgram,"uStateStyleSampler"),vertexTextureSizeUniform:t.getUniformLocation(this._shaderProgram,"uVertexTextureSize"),matrixTextureSizeUniform:t.getUniformLocation(this._shaderProgram,"uMatrixTextureSize"),styleTextureSizeUniform:t.getUniformLocation(this._shaderProgram,"uStyleTextureSize")},t.enableVertexAttribArray(this._pointers.normalAttrPointer),t.enableVertexAttribArray(this._pointers.indexlAttrPointer),t.enableVertexAttribArray(this._pointers.productAttrPointer),t.enableVertexAttribArray(this._pointers.stateAttrPointer),t.enableVertexAttribArray(this._pointers.styleAttrPointer),t.enableVertexAttribArray(this._pointers.transformationAttrPointer)},t.prototype._initMouseEvents=function(){var t=this,e=this,i=!1,r=null,n=null,a=null,o=null,s="L",u=-1,l=function(t){i=!0,r=t.clientX,n=t.clientY,a=t.clientX,o=t.clientY;var l=e._canvas.getBoundingClientRect(),A=a-l.left,c=e._height-(o-l.top);switch(u=e._getID(A,c),e._fire("mouseDown",{id:u}),t.button){case 0:s="left";break;case 1:s="middle";break;case 2:s="right";break;default:s="left"}e._disableTextSelection()},A=function(r){i=!1;var n=r.clientX,l=r.clientY,A=Math.abs(n-a),c=Math.abs(l-o);if(A<3&&c<3&&"left"===s){var h=!1;e._plugins.forEach(function(t){t.onBeforePick&&(h=h||t.onBeforePick(u))},t),h||e._fire("pick",{id:u})}e._enableTextSelection()},c=function(a){if(i&&"none"!==e.navigationMode){var o=a.clientX,u=a.clientY,l=o-r,A=u-n;if(r=o,n=u,"left"===s)switch(e.navigationMode){case"free-orbit":t.navigate("free-orbit",l,A);break;case"fixed-orbit":case"orbit":t.navigate("orbit",l,A);break;case"pan":t.navigate("pan",l,A);break;case"zoom":t.navigate("zoom",l,A)}"middle"===s&&t.navigate("pan",l,A)}},h=function(i){if("none"!==e.navigationMode){i.stopPropagation&&i.stopPropagation(),i.preventDefault&&i.preventDefault();var r=function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1};t.navigate("zoom",r(i.deltaX)*-1,r(i.deltaY)*-1)}},f=e.height,d=e.width;setInterval(function(){e._canvas.offsetHeight===f&&e._canvas.offsetWidth===d||(f=e._height=e._canvas.height=e._canvas.offsetHeight,d=e._width=e._canvas.width=e._canvas.offsetWidth)},500),this._canvas.addEventListener("mousedown",function(t){return l(t)},!0),this._canvas.addEventListener("wheel",function(t){return h(t)},!0),window.addEventListener("mouseup",function(t){return A(t)},!0),window.addEventListener("mousemove",function(t){return c(t)},!0),this._canvas.addEventListener("mousemove",function(){e._userAction=!0},!0),this._canvas.addEventListener("dblclick",function(){e._fire("dblclick",{id:u})},!0)},t.prototype._initTouchNavigationEvents=function(){var t,e,i,r,n,a,o=this,s=function(o){o.preventDefault(),o.touches.length>=1&&(t=o.touches[0].clientX,e=o.touches[0].clientY),o.touches.length>=2&&(i=o.touches[1].clientX,r=o.touches[1].clientY),o.touches.length>=3&&(n=o.touches[2].clientX,a=o.touches[2].clientY)},u=function(s){if(s.preventDefault(),"none"!==o.navigationMode&&s.touches)if(1===s.touches.length){var u=s.touches[0].clientX-t,l=s.touches[0].clientY-e;t=s.touches[0].clientX,e=s.touches[0].clientY,o.navigate("free-orbit",u,l)}else if(2===s.touches.length){var A=Math.sqrt((t-i)*(t-i)+(e-r)*(e-r));t=s.touches[0].clientX,e=s.touches[0].clientY,i=s.touches[1].clientX,r=s.touches[1].clientY;var c=Math.sqrt((t-i)*(t-i)+(e-r)*(e-r));A>c?o.navigate("zoom",-1,-1):o.navigate("zoom",1,1)}else if(3===s.touches.length){var h=(s.touches[0].clientX+s.touches[1].clientX+s.touches[2].clientX)/3-(t+i+n)/3,f=(s.touches[0].clientY+s.touches[1].clientY+s.touches[2].clientY)/3-(e+r+a)/3;t=s.touches[0].clientX,e=s.touches[0].clientY,i=s.touches[1].clientX,r=s.touches[1].clientY,a=s.touches[2].clientX,a=s.touches[2].clientY;var d=.2;o.navigate("pan",d*h,d*f)}};this._canvas.addEventListener("touchstart",function(t){return s(t)},!0),this._canvas.addEventListener("touchmove",function(t){return u(t)},!0)},t.prototype._initTouchTapEvents=function(){var t,e,i=this,r=!1,n=200,a=new Date,o=-1,s=function(s){if(1===s.touches.length){r=!0,t=s.touches[0].clientX,e=s.touches[0].clientY;var u=i._canvas.getBoundingClientRect(),l=t-u.left,A=i._height-(e-u.top);o=i._getID(l,A);var c=new Date,h=c.getTime()-a.getTime()<n;h&&i._fire("dblclick",{id:o}),a=c,i._fire("mouseDown",{id:o}),i._disableTextSelection()}},u=function(n){if(r){r=!1;var a=n.changedTouches[0].clientX,s=n.changedTouches[0].clientY,u=Math.abs(a-t),l=Math.abs(s-e);if(u<3&&l<3){var A=!1;i._plugins.forEach(function(t){t.onBeforePick&&(A=A||t.onBeforePick(o))},i),A||i._fire("pick",{id:o})}i._enableTextSelection()}};this._canvas.addEventListener("touchstart",function(t){return s(t)},!0),this._canvas.addEventListener("touchend",function(t){return u(t)},!0)},t.prototype.navigate=function(t,e,i){function r(t){return t*Math.PI/180}if(this._handles&&this._handles[0]){var n=this._origin,a=this.getCameraPosition(),o=u.vec3.transformMat4(u.vec3.create(),n,this._mvMatrix),s=u.vec3.subtract(u.vec3.create(),n,a),l=Math.max(u.vec3.length(s),this._handles[0]._model.meter),A=u.mat4.translate(u.mat4.create(),u.mat4.create(),o);switch(t){case"free-orbit":A=u.mat4.rotate(u.mat4.create(),A,r(i/4),[1,0,0]),A=u.mat4.rotate(u.mat4.create(),A,r(e/4),[0,1,0]);break;case"fixed-orbit":case"orbit":u.mat4.rotate(A,A,r(i/4),[1,0,0]);var c=u.vec3.transformMat3(u.vec3.create(),[0,0,1],u.mat3.fromMat4(u.mat3.create(),this._mvMatrix));c=u.vec3.normalize(u.vec3.create(),c),A=u.mat4.rotate(u.mat4.create(),A,r(e/4),c);break;case"pan":u.mat4.translate(A,A,[e*l/150,0,0]),u.mat4.translate(A,A,[0,-1*i*l/150,0]);break;case"zoom":u.mat4.translate(A,A,[0,0,e*l/20]),u.mat4.translate(A,A,[0,0,i*l/20])}var h=u.vec3.negate(u.vec3.create(),o);A=u.mat4.translate(u.mat4.create(),A,h),this._mvMatrix=u.mat4.multiply(u.mat4.create(),A,this._mvMatrix)}},t.prototype.draw=function(){if(this._geometryLoaded&&0!=this._handles.length&&(this._stylingChanged||this._isChanged())||this._userAction){this._userAction=!1,this._plugins.forEach(function(t){t.onBeforeDraw&&t.onBeforeDraw()},this),this._stylingChanged=!1;var t=this._gl,e=this._width,i=this._height;switch(t.useProgram(this._shaderProgram),t.viewport(0,0,e,i),t.clearColor(this.background[0]/255,this.background[1]/255,this.background[2]/255,this.background[3]/255),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.camera){case"perspective":u.mat4.perspective(this._pMatrix,this.perspectiveCamera.fov*Math.PI/180,this._width/this._height,this.perspectiveCamera.near,this.perspectiveCamera.far);break;case"orthogonal":u.mat4.ortho(this._pMatrix,this.orthogonalCamera.left,this.orthogonalCamera.right,this.orthogonalCamera.bottom,this.orthogonalCamera.top,this.orthogonalCamera.near,this.orthogonalCamera.far);break;default:u.mat4.perspective(this._pMatrix,this.perspectiveCamera.fov*Math.PI/180,this._width/this._height,this.perspectiveCamera.near,this.perspectiveCamera.far)}t.uniformMatrix4fv(this._pMatrixUniformPointer,!1,this._pMatrix),t.uniformMatrix4fv(this._mvMatrixUniformPointer,!1,this._mvMatrix),t.uniform4fv(this._lightAUniformPointer,new Float32Array(this.lightA)),t.uniform4fv(this._lightBUniformPointer,new Float32Array(this.lightB)),t.uniform4fv(this._clippingPlaneUniformPointer,new Float32Array(this.clippingPlane)),t.uniform1i(this._colorCodingUniformPointer,0),t.uniform4fv(this._highlightingColourUniformPointer,new Float32Array([this.highlightingColour[0]/255,this.highlightingColour[1]/255,this.highlightingColour[2]/255,this.highlightingColour[3]/255])),"x-ray"==this.renderingMode?(t.uniform1i(this._renderingModeUniformPointer,2),t.disable(t.CULL_FACE),this._handles.forEach(function(t){t.stopped||(t.setActive(this._pointers),t.draw("solid"))},this),t.uniform1i(this._renderingModeUniformPointer,2),t.enable(t.CULL_FACE),this._handles.forEach(function(t){t.stopped||(t.setActive(this._pointers),t.draw("transparent"))},this),t.uniform1i(this._renderingModeUniformPointer,0)):(t.uniform1i(this._renderingModeUniformPointer,0),t.disable(t.CULL_FACE),this._handles.forEach(function(t){t.stopped||(t.setActive(this._pointers),t.draw("solid"))},this),this._handles.forEach(function(t){t.stopped||(t.setActive(this._pointers),t.draw("transparent"))},this)),this._plugins.forEach(function(t){t.onAfterDraw&&t.onAfterDraw()},this),this._fire("frame",{})}},t.prototype._isChanged=function(){var t=!0;return this._visualStateAttributes.forEach(function(e){var i=JSON.stringify(this[e]),r=this._lastStates[e];this._lastStates[e]=i,t=t&&i===r},this),!t},t.prototype.getCameraPosition=function(){var t=u.mat4.create();u.mat4.multiply(t,this._pMatrix,this._mvMatrix);var e=u.mat4.create();u.mat4.invert(e,t);var i=u.vec3.create();return u.vec3.transformMat4(i,u.vec3.create(),e),i},t.prototype.zoomTo=function(t){var e=this.setCameraTarget(t);if(!e)return!1;var i=this.getCameraPosition(),r=u.vec3.create();u.vec3.subtract(r,i,this._origin),r=u.vec3.normalize(u.vec3.create(),r);var n=u.vec3.create();return u.vec3.scale(n,r,this._distance),u.vec3.add(i,n,this._origin),u.mat4.lookAt(this._mvMatrix,i,this._origin,[0,0,1]),!0},t.prototype.show=function(t){var e=this._origin,i=this._distance,r=[0,0,0],n=[0,0,1];switch(t){case"top":return void u.mat4.translate(this._mvMatrix,u.mat4.create(),[e[0]*-1,e[1]*-1,(i+e[2])*-1]);case"bottom":var a=u.mat4.translate(u.mat4.create(),u.mat4.create(),[e[0]*-1,1*e[1],(e[2]+i)*-1]),o=u.mat4.rotateY(u.mat4.create(),a,Math.PI),s=u.mat4.rotateZ(u.mat4.create(),o,Math.PI);return void(this._mvMatrix=s);case"front":r=[e[0],e[1]-i,e[2]];break;case"back":r=[e[0],e[1]+i,e[2]];break;case"left":r=[e[0]-i,e[1],e[2]];break;case"right":r=[e[0]+i,e[1],e[2]]}u.mat4.lookAt(this._mvMatrix,r,e,n)},t.prototype._error=function(t){this._fire("error",{message:t})},t.prototype._getID=function(t,e){this._plugins.forEach(function(t){t.onBeforeDrawId&&t.onBeforeDrawId()},this);var i=2,r=this._gl,n=this._width/i,a=this._height/i;t/=i,e/=i;var o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o);var s=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,s),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,n,a);var u=r.createTexture();if(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,u),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n,a,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,u,0),r.checkFramebufferStatus(r.FRAMEBUFFER)!=r.FRAMEBUFFER_COMPLETE)return this._error("this combination of attachments does not work"),null;r.bindFramebuffer(r.FRAMEBUFFER,o),r.viewport(0,0,n,a),r.enable(r.DEPTH_TEST),r.disable(r.BLEND),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.uniform1i(this._colorCodingUniformPointer,1),this._handles.forEach(function(t){t.stopped||(t.setActive(this._pointers),t.draw())},this),this._plugins.forEach(function(t){t.onAfterDrawId&&t.onAfterDrawId()},this);var l=new Uint8Array(4);r.readPixels(t,e,1,1,r.RGBA,r.UNSIGNED_BYTE,l),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(u),r.deleteRenderbuffer(s),r.deleteFramebuffer(o),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND);var A=0!=l[3];if(A){var c=l[0]+256*l[1]+256*l[2]*256,h=!1;return this._plugins.forEach(function(t){t.onBeforeGetId&&(h=h||t.onBeforeGetId(c))},this),h?null:c}return null},t.prototype.start=function(t){function e(){if(a++,30==a){a=0;var t=new Date,i=t.getTime()-n.getTime();n=t;var o=1e3/i*30;r._fire("fps",Math.floor(o))}r._isRunning&&(window.requestAnimFrame(e),r.draw())}if("undefined"!=typeof t){var i=this._handles.filter(function(e){return e.id===t}).pop();if("undefined"==typeof i)throw"Model doesn't exist.";return i.stopped=!1,void this._numberOfActiveModels++}this._isRunning=!0;var r=this,n=new Date,a=0;e()},t.prototype.stop=function(t){if("undefined"==typeof t)return void(this._isRunning=!1);var e=this._handles.filter(function(e){return e.id===t}).pop();if("undefined"==typeof e)throw"Model doesn't exist.";e.stopped=!0,this._numberOfActiveModels--},t.prototype.on=function(t,e){var i=this._events;i[t]||(i[t]=[]),i[t].push(e)},t.prototype.off=function(t,e){var i=this._events,r=i[t];if(r){var n=r.indexOf(e);n>=0&&r.splice(n,1)}},t.prototype._fire=function(t,e){var i=this._events[t];i&&i.forEach(function(t){t(e)},this)},t.prototype._disableTextSelection=function(){document.documentElement.style["-webkit-touch-callout"]="none",document.documentElement.style["-webkit-user-select"]="none",document.documentElement.style["-khtml-user-select"]="none",document.documentElement.style["-moz-user-select"]="none",document.documentElement.style["-ms-user-select"]="none",document.documentElement.style["user-select"]="none"},t.prototype._enableTextSelection=function(){document.documentElement.style["-webkit-touch-callout"]="text",document.documentElement.style["-webkit-user-select"]="text",document.documentElement.style["-khtml-user-select"]="text",document.documentElement.style["-moz-user-select"]="text",document.documentElement.style["-ms-user-select"]="text",document.documentElement.style["user-select"]="text"},t.prototype._getSVGOverlay=function(){function t(t){var e=t.getBoundingClientRect(),i=document.body,r=document.documentElement,n=window.pageYOffset||r.scrollTop||i.scrollTop,a=window.pageXOffset||r.scrollLeft||i.scrollLeft,o=r.clientTop||i.clientTop||0,s=r.clientLeft||i.clientLeft||0,u=r.clientBottom||i.clientBottom||0,l=r.clientRight||i.clientRight||0,A=Math.round(e.top+n-o),c=Math.round(e.left+a-s),h=Math.round(e.top+n-u),f=Math.round(e.left+a-l);return{top:A,left:c,width:f-c,height:h-A}}if(!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))return!1;var e="http://www.w3.org/2000/svg",i=document.createElementNS(e,"svg"),r=t(this._canvas);return i.style.position="absolute",i.style.top=r.top+"px",i.style.left=r.left+"px",i.style["z-index"]=100,i.setAttribute("width",this._width.toString()),i.setAttribute("height",this._height.toString()),i},t.prototype.getClip=function(){var t=this.clippingPlane;if(t.every(function(t){return 0===t}))return[[0,0,0],[0,0,0]];var e=u.vec3.normalize([0,0,0],[t[0],t[1],t[2]]),i=this._lastClippingPoint,r=i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+t[3];if(Math.abs(r)<1e-5)return[i,e];var n=0!==t[0]?-1*t[3]/t[0]:0,a=0!==t[1]?-1*t[3]/t[1]:0,o=0!==t[2]?-1*t[3]/t[2]:0;return[[n,a,o],e]},t.prototype.clip=function(t,e){if("undefined"!=typeof t&&"undefined"!=typeof e){this._lastClippingPoint=t;var i=0-e[0]*t[0]-e[1]*t[1]-e[2]*t[2];return this.clippingPlane=[e[0],e[1],e[2],i],void this._fire("clipped",{})}var r="http://www.w3.org/2000/svg",n=this._getSVGOverlay(),a=this,o={},s=!1,l={},A=function(t){if(!s){s=!0,a._disableTextSelection();var e=n.getBoundingClientRect();o.x=t.clientX-e.left,o.y=t.clientY-e.top,o.angle=0,l=document.createElementNS(r,"g"),l.setAttribute("id","section"),n.appendChild(l);var i=document.createElementNS(r,"line");l.appendChild(i),i.setAttribute("style","stroke:rgb(255,0,0);stroke-width:2"),i.setAttribute("x1",o.x.toString()),i.setAttribute("y1","99999"),i.setAttribute("x2",o.x.toString()),i.setAttribute("y2","-99999")}},c=function(t){if(s){var e=n.getBoundingClientRect();if(o.x!=t.clientX-e.left||o.y!=t.clientY-e.top){s=!1,a._enableTextSelection();var i=u.mat4.create();u.mat4.multiply(i,a._pMatrix,a._mvMatrix);var r=u.mat4.create();u.mat4.invert(r,i);var l=o.x/(a._width/2)-1,f=1-o.y/(a._height/2),d=u.vec3.create();u.vec3.transformMat4(d,[l,f,-1],r);var p=u.vec3.create();u.vec3.transformMat4(p,[l,f,1],r);var m=o.angle*Math.PI/180,g=l+Math.cos(m),v=f+Math.sin(m),T=u.vec3.create();u.vec3.transformMat4(T,[g,v,1],r);var I=u.vec3.subtract(u.vec3.create(),d,p),E=u.vec3.subtract(u.vec3.create(),T,p),C=u.vec3.cross(u.vec3.create(),I,E);a.clip(p,C),n.parentNode.removeChild(n),n.removeEventListener("mousedown",A,!0),window.removeEventListener("mouseup",c,!0),window.removeEventListener("mousemove",h,!0)}}},h=function(t){if(s){var e=n.getBoundingClientRect(),i=t.clientX-e.left,r=t.clientY-e.top,a=i-o.x,u=r-o.y,A=Math.atan2(a,u)*-180/Math.PI+90;A=5*Math.round(A/5),
o.angle=360-A+90,l.setAttribute("transform","rotate("+A+" "+o.x+" "+o.y+")")}};document.documentElement.appendChild(n),n.addEventListener("mousedown",A,!0),window.addEventListener("mouseup",c,!0),window.addEventListener("mousemove",h,!0),this.stopClipping=function(){n.parentNode.removeChild(n),n.removeEventListener("mousedown",A,!0),window.removeEventListener("mouseup",c,!0),window.removeEventListener("mousemove",h,!0),a.stopClipping=function(){}}},t.prototype.stopClipping=function(){},t.prototype.unclip=function(){this.clippingPlane=[0,0,0,0],this._fire("unclipped",{})},t}();e.xViewer=l},function(t,e,i){!function(t){"use strict";var i={};i.exports=e,function(t){if(!e)var e=1e-6;if(!i)var i="undefined"!=typeof Float32Array?Float32Array:Array;if(!r)var r=Math.random;var n={};n.setMatrixArrayType=function(t){i=t},"undefined"!=typeof t&&(t.glMatrix=n);var a=Math.PI/180;n.toRadian=function(t){return t*a};var o={};o.create=function(){var t=new i(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var e=new i(2);return e[0]=t[0],e[1]=t[1],e},o.fromValues=function(t,e){var r=new i(2);return r[0]=t,r[1]=e,r},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},o.set=function(t,e,i){return t[0]=e,t[1]=i,t},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},o.sub=o.subtract,o.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},o.mul=o.multiply,o.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},o.div=o.divide,o.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},o.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},o.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},o.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t},o.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)},o.dist=o.distance,o.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},o.len=o.length,o.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},o.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},o.normalize=function(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},o.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},o.lerp=function(t,e,i,r){var n=e[0],a=e[1];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t},o.random=function(t,e){e=e||1;var i=2*r()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},o.transformMat2=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t},o.transformMat2d=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t},o.transformMat3=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t},o.transformMat4=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t},o.forEach=function(){var t=o.create();return function(e,i,r,n,a,o){var s,u;for(i||(i=2),r||(r=0),u=n?Math.min(n*i+r,e.length):e.length,s=r;s<u;s+=i)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}(),o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=o);var s={};s.create=function(){var t=new i(3);return t[0]=0,t[1]=0,t[2]=0,t},s.clone=function(t){var e=new i(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},s.fromValues=function(t,e,r){var n=new i(3);return n[0]=t,n[1]=e,n[2]=r,n},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},s.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},s.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},s.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},s.sub=s.subtract,s.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},s.mul=s.multiply,s.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},s.div=s.divide,s.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},s.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},s.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},s.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t},s.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)},s.dist=s.distance,s.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)},s.len=s.length,s.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},s.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},s.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},s.cross=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[0],s=i[1],u=i[2];return t[0]=n*u-a*s,t[1]=a*o-r*u,t[2]=r*s-n*o,t},s.lerp=function(t,e,i,r){var n=e[0],a=e[1],o=e[2];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=o+r*(i[2]-o),t},s.random=function(t,e){e=e||1;var i=2*r()*Math.PI,n=2*r()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*a,t[1]=Math.sin(i)*a,t[2]=n*e,t},s.transformMat4=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[3]*r+i[7]*n+i[11]*a+i[15];return o=o||1,t[0]=(i[0]*r+i[4]*n+i[8]*a+i[12])/o,t[1]=(i[1]*r+i[5]*n+i[9]*a+i[13])/o,t[2]=(i[2]*r+i[6]*n+i[10]*a+i[14])/o,t},s.transformMat3=function(t,e,i){var r=e[0],n=e[1],a=e[2];return t[0]=r*i[0]+n*i[3]+a*i[6],t[1]=r*i[1]+n*i[4]+a*i[7],t[2]=r*i[2]+n*i[5]+a*i[8],t},s.transformQuat=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[0],s=i[1],u=i[2],l=i[3],A=l*r+s*a-u*n,c=l*n+u*r-o*a,h=l*a+o*n-s*r,f=-o*r-s*n-u*a;return t[0]=A*l+f*-o+c*-u-h*-s,t[1]=c*l+f*-s+h*-o-A*-u,t[2]=h*l+f*-u+A*-s-c*-o,t},s.rotateX=function(t,e,i,r){var n=[],a=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],a[0]=n[0],a[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),a[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t},s.rotateY=function(t,e,i,r){var n=[],a=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],a[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),a[1]=n[1],a[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t},s.rotateZ=function(t,e,i,r){var n=[],a=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],a[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),a[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),a[2]=n[2],t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t},s.forEach=function(){var t=s.create();return function(e,i,r,n,a,o){var s,u;for(i||(i=3),r||(r=0),u=n?Math.min(n*i+r,e.length):e.length,s=r;s<u;s+=i)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),s.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=s);var u={};u.create=function(){var t=new i(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},u.clone=function(t){var e=new i(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.fromValues=function(t,e,r,n){var a=new i(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a},u.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},u.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},u.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},u.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},u.sub=u.subtract,u.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},u.mul=u.multiply,u.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},u.div=u.divide,u.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},u.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},u.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},u.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},u.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+a*a)},u.dist=u.distance,u.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return i*i+r*r+n*n+a*a},u.sqrDist=u.squaredDistance,u.length=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)},u.len=u.length,u.squaredLength=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n},u.sqrLen=u.squaredLength,u.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},u.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},u.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i*i+r*r+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o),t},u.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},u.lerp=function(t,e,i,r){var n=e[0],a=e[1],o=e[2],s=e[3];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=o+r*(i[2]-o),t[3]=s+r*(i[3]-s),t},u.random=function(t,e){return e=e||1,t[0]=r(),t[1]=r(),t[2]=r(),t[3]=r(),u.normalize(t,t),u.scale(t,t,e),t},u.transformMat4=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*o,t[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*o,t[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*o,t[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*o,t},u.transformQuat=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=i[0],s=i[1],u=i[2],l=i[3],A=l*r+s*a-u*n,c=l*n+u*r-o*a,h=l*a+o*n-s*r,f=-o*r-s*n-u*a;return t[0]=A*l+f*-o+c*-u-h*-s,t[1]=c*l+f*-s+h*-o-A*-u,t[2]=h*l+f*-u+A*-s-c*-o,t},u.forEach=function(){var t=u.create();return function(e,i,r,n,a,o){var s,u;for(i||(i=4),r||(r=0),u=n?Math.min(n*i+r,e.length):e.length,s=r;s<u;s+=i)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),u.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=u);var l={};l.create=function(){var t=new i(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},l.clone=function(t){var e=new i(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},l.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},l.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},l.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},l.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i*a-n*r;return o?(o=1/o,t[0]=a*o,t[1]=-r*o,t[2]=-n*o,t[3]=i*o,t):null},l.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},l.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},l.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=i[0],u=i[1],l=i[2],A=i[3];return t[0]=r*s+a*u,t[1]=n*s+o*u,t[2]=r*l+a*A,t[3]=n*l+o*A,t},l.mul=l.multiply,l.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+a*s,t[1]=n*u+o*s,t[2]=r*-s+a*u,t[3]=n*-s+o*u,t},l.scale=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=i[0],u=i[1];return t[0]=r*s,t[1]=n*s,t[2]=a*u,t[3]=o*u,t},l.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},l.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},l.LDU=function(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]},"undefined"!=typeof t&&(t.mat2=l);var A={};A.create=function(){var t=new i(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},A.clone=function(t){var e=new i(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},A.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},A.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},A.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=i*a-r*n;return u?(u=1/u,t[0]=a*u,t[1]=-r*u,t[2]=-n*u,t[3]=i*u,t[4]=(n*s-a*o)*u,t[5]=(r*o-i*s)*u,t):null},A.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},A.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=i[0],A=i[1],c=i[2],h=i[3],f=i[4],d=i[5];return t[0]=r*l+a*A,t[1]=n*l+o*A,t[2]=r*c+a*h,t[3]=n*c+o*h,t[4]=r*f+a*d+s,t[5]=n*f+o*d+u,t},A.mul=A.multiply,A.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=Math.sin(i),A=Math.cos(i);return t[0]=r*A+a*l,t[1]=n*A+o*l,t[2]=r*-l+a*A,t[3]=n*-l+o*A,t[4]=s,t[5]=u,t},A.scale=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=i[0],A=i[1];return t[0]=r*l,t[1]=n*l,t[2]=a*A,t[3]=o*A,t[4]=s,t[5]=u,t},A.translate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=i[0],A=i[1];return t[0]=r,t[1]=n,t[2]=a,t[3]=o,t[4]=r*l+a*A+s,t[5]=n*l+o*A+u,t},A.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},A.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},"undefined"!=typeof t&&(t.mat2d=A);var c={};c.create=function(){var t=new i(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},c.clone=function(t){var e=new i(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},c.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},c.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],A=e[8],c=A*o-s*l,h=-A*a+s*u,f=l*a-o*u,d=i*c+r*h+n*f;return d?(d=1/d,t[0]=c*d,t[1]=(-A*r+n*l)*d,t[2]=(s*r-n*o)*d,t[3]=h*d,t[4]=(A*i-n*u)*d,t[5]=(-s*i+n*a)*d,t[6]=f*d,t[7]=(-l*i+r*u)*d,t[8]=(o*i-r*a)*d,t):null},c.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],A=e[8];return t[0]=o*A-s*l,t[1]=n*l-r*A,t[2]=r*s-n*o,t[3]=s*u-a*A,t[4]=i*A-n*u,t[5]=n*a-i*s,t[6]=a*l-o*u,t[7]=r*u-i*l,t[8]=i*o-r*a,t},c.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return e*(l*a-o*u)+i*(-l*n+o*s)+r*(u*n-a*s)},c.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],A=e[7],c=e[8],h=i[0],f=i[1],d=i[2],p=i[3],m=i[4],g=i[5],v=i[6],T=i[7],I=i[8];return t[0]=h*r+f*o+d*l,t[1]=h*n+f*s+d*A,t[2]=h*a+f*u+d*c,t[3]=p*r+m*o+g*l,t[4]=p*n+m*s+g*A,t[5]=p*a+m*u+g*c,t[6]=v*r+T*o+I*l,t[7]=v*n+T*s+I*A,t[8]=v*a+T*u+I*c,t},c.mul=c.multiply,c.translate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],A=e[7],c=e[8],h=i[0],f=i[1];return t[0]=r,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=h*r+f*o+l,t[7]=h*n+f*s+A,t[8]=h*a+f*u+c,t},c.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],A=e[7],c=e[8],h=Math.sin(i),f=Math.cos(i);return t[0]=f*r+h*o,t[1]=f*n+h*s,t[2]=f*a+h*u,t[3]=f*o-h*r,t[4]=f*s-h*n,t[5]=f*u-h*a,t[6]=l,t[7]=A,t[8]=c,t},c.scale=function(t,e,i){var r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},c.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i+i,s=r+r,u=n+n,l=i*o,A=r*o,c=r*s,h=n*o,f=n*s,d=n*u,p=a*o,m=a*s,g=a*u;return t[0]=1-c-d,t[3]=A-g,t[6]=h+m,t[1]=A+g,t[4]=1-l-d,t[7]=f-p,t[2]=h-m,t[5]=f+p,t[8]=1-l-c,t},c.normalFromMat4=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],A=e[8],c=e[9],h=e[10],f=e[11],d=e[12],p=e[13],m=e[14],g=e[15],v=i*s-r*o,T=i*u-n*o,I=i*l-a*o,E=r*u-n*s,C=r*l-a*s,y=n*l-a*u,_=A*p-c*d,b=A*m-h*d,x=A*g-f*d,S=c*m-h*p,R=c*g-f*p,M=h*g-f*m,F=v*M-T*R+I*S+E*x-C*b+y*_;return F?(F=1/F,t[0]=(s*M-u*R+l*S)*F,t[1]=(u*x-o*M-l*b)*F,t[2]=(o*R-s*x+l*_)*F,t[3]=(n*R-r*M-a*S)*F,t[4]=(i*M-n*x+a*b)*F,t[5]=(r*x-i*R-a*_)*F,t[6]=(p*y-m*C+g*E)*F,t[7]=(m*I-d*y-g*T)*F,t[8]=(d*C-p*I+g*v)*F,t):null},c.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},c.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},"undefined"!=typeof t&&(t.mat3=c);var h={};h.create=function(){var t=new i(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.clone=function(t){var e=new i(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},h.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},h.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],A=e[8],c=e[9],h=e[10],f=e[11],d=e[12],p=e[13],m=e[14],g=e[15],v=i*s-r*o,T=i*u-n*o,I=i*l-a*o,E=r*u-n*s,C=r*l-a*s,y=n*l-a*u,_=A*p-c*d,b=A*m-h*d,x=A*g-f*d,S=c*m-h*p,R=c*g-f*p,M=h*g-f*m,F=v*M-T*R+I*S+E*x-C*b+y*_;return F?(F=1/F,t[0]=(s*M-u*R+l*S)*F,t[1]=(n*R-r*M-a*S)*F,t[2]=(p*y-m*C+g*E)*F,t[3]=(h*C-c*y-f*E)*F,t[4]=(u*x-o*M-l*b)*F,t[5]=(i*M-n*x+a*b)*F,t[6]=(m*I-d*y-g*T)*F,t[7]=(A*y-h*I+f*T)*F,t[8]=(o*R-s*x+l*_)*F,t[9]=(r*x-i*R-a*_)*F,t[10]=(d*C-p*I+g*v)*F,t[11]=(c*I-A*C-f*v)*F,t[12]=(s*b-o*S-u*_)*F,t[13]=(i*S-r*b+n*_)*F,t[14]=(p*T-d*E-m*v)*F,t[15]=(A*E-c*T+h*v)*F,t):null},h.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],A=e[8],c=e[9],h=e[10],f=e[11],d=e[12],p=e[13],m=e[14],g=e[15];return t[0]=s*(h*g-f*m)-c*(u*g-l*m)+p*(u*f-l*h),t[1]=-(r*(h*g-f*m)-c*(n*g-a*m)+p*(n*f-a*h)),t[2]=r*(u*g-l*m)-s*(n*g-a*m)+p*(n*l-a*u),t[3]=-(r*(u*f-l*h)-s*(n*f-a*h)+c*(n*l-a*u)),t[4]=-(o*(h*g-f*m)-A*(u*g-l*m)+d*(u*f-l*h)),t[5]=i*(h*g-f*m)-A*(n*g-a*m)+d*(n*f-a*h),t[6]=-(i*(u*g-l*m)-o*(n*g-a*m)+d*(n*l-a*u)),t[7]=i*(u*f-l*h)-o*(n*f-a*h)+A*(n*l-a*u),t[8]=o*(c*g-f*p)-A*(s*g-l*p)+d*(s*f-l*c),t[9]=-(i*(c*g-f*p)-A*(r*g-a*p)+d*(r*f-a*c)),t[10]=i*(s*g-l*p)-o*(r*g-a*p)+d*(r*l-a*s),t[11]=-(i*(s*f-l*c)-o*(r*f-a*c)+A*(r*l-a*s)),t[12]=-(o*(c*m-h*p)-A*(s*m-u*p)+d*(s*h-u*c)),t[13]=i*(c*m-h*p)-A*(r*m-n*p)+d*(r*h-n*c),t[14]=-(i*(s*m-u*p)-o*(r*m-n*p)+d*(r*u-n*s)),t[15]=i*(s*h-u*c)-o*(r*h-n*c)+A*(r*u-n*s),t},h.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],A=t[9],c=t[10],h=t[11],f=t[12],d=t[13],p=t[14],m=t[15],g=e*o-i*a,v=e*s-r*a,T=e*u-n*a,I=i*s-r*o,E=i*u-n*o,C=r*u-n*s,y=l*d-A*f,_=l*p-c*f,b=l*m-h*f,x=A*p-c*d,S=A*m-h*d,R=c*m-h*p;return g*R-v*S+T*x+I*b-E*_+C*y},h.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],A=e[7],c=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],v=e[15],T=i[0],I=i[1],E=i[2],C=i[3];return t[0]=T*r+I*s+E*c+C*p,t[1]=T*n+I*u+E*h+C*m,t[2]=T*a+I*l+E*f+C*g,t[3]=T*o+I*A+E*d+C*v,T=i[4],I=i[5],E=i[6],C=i[7],t[4]=T*r+I*s+E*c+C*p,t[5]=T*n+I*u+E*h+C*m,t[6]=T*a+I*l+E*f+C*g,t[7]=T*o+I*A+E*d+C*v,T=i[8],I=i[9],E=i[10],C=i[11],t[8]=T*r+I*s+E*c+C*p,t[9]=T*n+I*u+E*h+C*m,t[10]=T*a+I*l+E*f+C*g,t[11]=T*o+I*A+E*d+C*v,T=i[12],I=i[13],E=i[14],C=i[15],t[12]=T*r+I*s+E*c+C*p,t[13]=T*n+I*u+E*h+C*m,t[14]=T*a+I*l+E*f+C*g,t[15]=T*o+I*A+E*d+C*v,t},h.mul=h.multiply,h.translate=function(t,e,i){var r,n,a,o,s,u,l,A,c,h,f,d,p=i[0],m=i[1],g=i[2];return e===t?(t[12]=e[0]*p+e[4]*m+e[8]*g+e[12],t[13]=e[1]*p+e[5]*m+e[9]*g+e[13],t[14]=e[2]*p+e[6]*m+e[10]*g+e[14],t[15]=e[3]*p+e[7]*m+e[11]*g+e[15]):(r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],A=e[7],c=e[8],h=e[9],f=e[10],d=e[11],t[0]=r,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=A,t[8]=c,t[9]=h,t[10]=f,t[11]=d,t[12]=r*p+s*m+c*g+e[12],t[13]=n*p+u*m+h*g+e[13],t[14]=a*p+l*m+f*g+e[14],t[15]=o*p+A*m+d*g+e[15]),t},h.scale=function(t,e,i){var r=i[0],n=i[1],a=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.rotate=function(t,i,r,n){var a,o,s,u,l,A,c,h,f,d,p,m,g,v,T,I,E,C,y,_,b,x,S,R,M=n[0],F=n[1],B=n[2],P=Math.sqrt(M*M+F*F+B*B);return Math.abs(P)<e?null:(P=1/P,M*=P,F*=P,B*=P,a=Math.sin(r),o=Math.cos(r),s=1-o,u=i[0],l=i[1],A=i[2],c=i[3],h=i[4],f=i[5],d=i[6],p=i[7],m=i[8],g=i[9],v=i[10],T=i[11],I=M*M*s+o,E=F*M*s+B*a,C=B*M*s-F*a,y=M*F*s-B*a,_=F*F*s+o,b=B*F*s+M*a,x=M*B*s+F*a,S=F*B*s-M*a,R=B*B*s+o,t[0]=u*I+h*E+m*C,t[1]=l*I+f*E+g*C,t[2]=A*I+d*E+v*C,t[3]=c*I+p*E+T*C,t[4]=u*y+h*_+m*b,t[5]=l*y+f*_+g*b,t[6]=A*y+d*_+v*b,t[7]=c*y+p*_+T*b,t[8]=u*x+h*S+m*R,t[9]=l*x+f*S+g*R,t[10]=A*x+d*S+v*R,t[11]=c*x+p*S+T*R,i!==t&&(t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t)},h.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],A=e[9],c=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+l*r,t[5]=o*n+A*r,t[6]=s*n+c*r,t[7]=u*n+h*r,t[8]=l*n-a*r,t[9]=A*n-o*r,t[10]=c*n-s*r,t[11]=h*n-u*r,t},h.rotateY=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],A=e[9],c=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-l*r,t[1]=o*n-A*r,t[2]=s*n-c*r,t[3]=u*n-h*r,t[8]=a*r+l*n,t[9]=o*r+A*n,t[10]=s*r+c*n,t[11]=u*r+h*n,t},h.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],A=e[5],c=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+l*r,t[1]=o*n+A*r,t[2]=s*n+c*r,t[3]=u*n+h*r,t[4]=l*n-a*r,t[5]=A*n-o*r,t[6]=c*n-s*r,t[7]=h*n-u*r,t},h.fromRotationTranslation=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=r+r,u=n+n,l=a+a,A=r*s,c=r*u,h=r*l,f=n*u,d=n*l,p=a*l,m=o*s,g=o*u,v=o*l;return t[0]=1-(f+p),t[1]=c+v,t[2]=h-g,t[3]=0,t[4]=c-v,t[5]=1-(A+p),t[6]=d+m,t[7]=0,t[8]=h+g,t[9]=d-m,t[10]=1-(A+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},h.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i+i,s=r+r,u=n+n,l=i*o,A=r*o,c=r*s,h=n*o,f=n*s,d=n*u,p=a*o,m=a*s,g=a*u;return t[0]=1-c-d,t[1]=A+g,t[2]=h-m,t[3]=0,t[4]=A-g,t[5]=1-l-d,t[6]=f+p,t[7]=0,t[8]=h+m,t[9]=f-p,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.frustum=function(t,e,i,r,n,a,o){var s=1/(i-e),u=1/(n-r),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(i+e)*s,t[9]=(n+r)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t},h.perspective=function(t,e,i,r,n){var a=1/Math.tan(e/2),o=1/(r-n);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*o,t[15]=0,t},h.ortho=function(t,e,i,r,n,a,o){var s=1/(e-i),u=1/(r-n),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*s,t[13]=(n+r)*u,t[14]=(o+a)*l,t[15]=1,t},h.lookAt=function(t,i,r,n){var a,o,s,u,l,A,c,f,d,p,m=i[0],g=i[1],v=i[2],T=n[0],I=n[1],E=n[2],C=r[0],y=r[1],_=r[2];return Math.abs(m-C)<e&&Math.abs(g-y)<e&&Math.abs(v-_)<e?h.identity(t):(c=m-C,f=g-y,d=v-_,p=1/Math.sqrt(c*c+f*f+d*d),c*=p,f*=p,d*=p,a=I*d-E*f,o=E*c-T*d,s=T*f-I*c,p=Math.sqrt(a*a+o*o+s*s),p?(p=1/p,a*=p,o*=p,s*=p):(a=0,o=0,s=0),u=f*s-d*o,l=d*a-c*s,A=c*o-f*a,p=Math.sqrt(u*u+l*l+A*A),p?(p=1/p,u*=p,l*=p,A*=p):(u=0,l=0,A=0),t[0]=a,t[1]=u,t[2]=c,t[3]=0,t[4]=o,t[5]=l,t[6]=f,t[7]=0,t[8]=s,t[9]=A,t[10]=d,t[11]=0,t[12]=-(a*m+o*g+s*v),t[13]=-(u*m+l*g+A*v),t[14]=-(c*m+f*g+d*v),t[15]=1,t)},h.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},h.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},"undefined"!=typeof t&&(t.mat4=h);var f={};f.create=function(){var t=new i(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},f.rotationTo=function(){var t=s.create(),e=s.fromValues(1,0,0),i=s.fromValues(0,1,0);return function(r,n,a){var o=s.dot(n,a);return o<-.999999?(s.cross(t,e,n),s.length(t)<1e-6&&s.cross(t,i,n),s.normalize(t,t),f.setAxisAngle(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(s.cross(t,n,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,f.normalize(r,r))}}(),f.setAxes=function(){var t=c.create();return function(e,i,r,n){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],f.normalize(e,f.fromMat3(e,t))}}(),f.clone=u.clone,f.fromValues=u.fromValues,f.copy=u.copy,f.set=u.set,f.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},f.setAxisAngle=function(t,e,i){i*=.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t},f.add=u.add,f.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],o=e[3],s=i[0],u=i[1],l=i[2],A=i[3];return t[0]=r*A+o*s+n*l-a*u,t[1]=n*A+o*u+a*s-r*l,t[2]=a*A+o*l+r*u-n*s,t[3]=o*A-r*s-n*u-a*l,t},f.mul=f.multiply,f.scale=u.scale,f.rotateX=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+o*s,t[1]=n*u+a*s,t[2]=a*u-n*s,t[3]=o*u-r*s,t},f.rotateY=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u-a*s,t[1]=n*u+o*s,t[2]=a*u+r*s,t[3]=o*u-n*s,t},f.rotateZ=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*s,t[1]=n*u-r*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t},f.calculateW=function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t},f.dot=u.dot,f.lerp=u.lerp,f.slerp=function(t,e,i,r){var n,a,o,s,u,l=e[0],A=e[1],c=e[2],h=e[3],f=i[0],d=i[1],p=i[2],m=i[3];return a=l*f+A*d+c*p+h*m,a<0&&(a=-a,f=-f,d=-d,p=-p,m=-m),1-a>1e-6?(n=Math.acos(a),o=Math.sin(n),s=Math.sin((1-r)*n)/o,u=Math.sin(r*n)/o):(s=1-r,u=r),t[0]=s*l+u*f,t[1]=s*A+u*d,t[2]=s*c+u*p,t[3]=s*h+u*m,t},f.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],o=i*i+r*r+n*n+a*a,s=o?1/o:0;return t[0]=-i*s,t[1]=-r*s,t[2]=-n*s,t[3]=a*s,t},f.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},f.length=u.length,f.len=f.length,f.squaredLength=u.squaredLength,f.sqrLen=f.squaredLength,f.normalize=u.normalize,f.fromMat3=function(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*a+a]-e[3*o+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*a+o]-e[3*o+a])*i,t[a]=(e[3*a+n]+e[3*n+a])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t},f.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=f)}(i.exports)}(this)},function(t,e){WebGLUtils=function(){var t=function(t){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>"},e='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',i='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>',r=function(r,a,o){function s(n){var a=r.parentNode;if(a){var o=window.WebGLRenderingContext?i:e;n&&(o+="<br/><br/>Status: "+n),a.innerHTML=t(o)}}o=o||s,r.addEventListener&&r.addEventListener("webglcontextcreationerror",function(t){o(t.statusMessage)},!1);var u=n(r,a);return u||window.WebGLRenderingContext||o(""),u},n=function(t,e){for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null,n=0;n<i.length;++n){try{r=t.getContext(i[n],e)}catch(t){}if(r)break}return r};return{create3DContext:n,setupWebGL:r}}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}()},function(t,e,i){(function(t){t.xCubeShaders=t.xCubeShaders?t.xCubeShaders:i(14).xShaders,t.xCubeTextures=t.xCubeTextures?t.xCubeTextures:i(15).xCubeTextures,t.xNavigationCube=t.xNavigationCube?t.xNavigationCube:i(16).xNavigationCube,t.xHomeTextures=t.xHomeTextures?t.xHomeTextures:i(17).xHomeTextures,t.xNavigationHome=t.xNavigationHome?t.xNavigationHome:i(18).xNavigationHome}).call(e,function(){return this}())},function(t,e){"use strict";e.xCubeShaders={cube_fshader:" precision mediump float; uniform float uAlpha; uniform sampler2D uTexture; uniform bool uColorCoding; uniform float uHighlighting; varying vec2 vTexCoord; varying vec4 vIdColor; void main(void) { if (uColorCoding) { gl_FragColor = vIdColor; } else { vec4 pixel = texture2D(uTexture, vTexCoord); if (vIdColor.x < 0.0) { gl_FragColor = vec4(pixel.rgb * uHighlighting, uAlpha); } else { gl_FragColor = vec4(pixel.rgb, uAlpha); } } }",cube_vshader:" attribute highp vec3 aVertex; attribute highp vec2 aTexCoord; attribute highp float aId; uniform mat3 uRotation; uniform mat4 uPMatrix; uniform bool uColorCoding; uniform float uSelection; varying vec2 vTexCoord; varying vec4 vIdColor; vec4 getIdColor(float id){ float product = floor(id + 0.5); float B = floor(product / (256.0*256.0)); float G = floor((product - B * 256.0*256.0) / 256.0); float R = mod(product, 256.0); return vec4(R / 255.0, G / 255.0, B / 255.0, 1.0); } void main(void) { vec4 point = vec4(uRotation * aVertex, 1.0); gl_Position = uPMatrix * point; vTexCoord = aTexCoord; if (uColorCoding) { vIdColor = getIdColor(aId); return; } bool isSelected = abs(uSelection - aId) < 0.1; if (isSelected){ vIdColor = vec4(-1.0, -1.0, -1.0, -1.0); } else{ vIdColor = vec4(1.0, 1.0, 1.0, 1.0); } }"}},function(t,e){"use strict";e.xCubeTextures={en:"data:image/png;base64,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"
}},function(t,e,i){"use strict";var r=i(15),n=i(14),a=i(11),o=function(){function t(t){this.TOP=16e5,this.BOTTOM=1600001,this.LEFT=1600002,this.RIGHT=1600003,this.FRONT=1600004,this.BACK=1600005,this.TOP_LEFT_FRONT=1600006,this.TOP_RIGHT_FRONT=1600007,this.TOP_LEFT_BACK=1600008,this.TOP_RIGHT_BACK=1600009,this.BOTTOM_LEFT_FRONT=1600010,this.BOTTOM_RIGHT_FRONT=1600011,this.BOTTOM_LEFT_BACK=1600012,this.BOTTOM_RIGHT_BACK=1600013,this.TOP_LEFT=1600014,this.TOP_RIGHT=1600015,this.TOP_FRONT=1600016,this.TOP_BACK=1600017,this.BOTTOM_LEFT=1600018,this.BOTTOM_RIGHT=1600019,this.BOTTOM_FRONT=1600020,this.BOTTOM_BACK=1600021,this.FRONT_RIGHT=1600022,this.FRONT_LEFT=1600023,this.BACK_RIGHT=1600024,this.BACK_LEFT=1600025,this._initialized=!1,this.ratio=.15,this.highlighting=1.2,this.activeAlpha=1,this.passiveAlpha=.3,this.position=this.BOTTOM_RIGHT,this.vertices=new Float32Array([-.3,-.5,-.3,.3,-.5,-.3,.3,-.5,.3,-.3,-.5,.3,-.3,.5,-.3,-.3,.5,.3,.3,.5,.3,.3,.5,-.3,-.3,-.3,.5,.3,-.3,.5,.3,.3,.5,-.3,.3,.5,-.3,-.3,-.5,-.3,.3,-.5,.3,.3,-.5,.3,-.3,-.5,.5,-.3,-.3,.5,.3,-.3,.5,.3,.3,.5,-.3,.3,-.5,-.3,-.3,-.5,-.3,.3,-.5,.3,.3,-.5,.3,-.3,-.5,-.5,.5,-.3,-.5,.5,-.3,-.3,.5,-.5,-.3,.5,-.5,-.5,.3,-.5,-.5,.5,-.5,-.3,.5,-.5,-.3,.3,-.5,-.5,.3,-.3,-.5,.3,-.3,-.5,.5,-.5,-.5,.5,.3,-.5,.5,.5,-.5,.5,.5,-.3,.5,.3,-.3,.5,.5,-.5,.3,.5,-.3,.3,.5,-.3,.5,.5,-.5,.5,.3,-.5,.3,.5,-.5,.3,.5,-.5,.5,.3,-.5,.5,-.5,.3,.5,-.3,.3,.5,-.3,.5,.5,-.5,.5,.5,-.5,.3,.3,-.5,.3,.5,-.5,.5,.5,-.5,.5,.3,-.5,.5,.3,-.5,.5,.5,-.3,.5,.5,-.3,.5,.3,.3,.3,.5,.5,.3,.5,.5,.5,.5,.3,.5,.5,.5,.3,.3,.5,.5,.3,.5,.5,.5,.5,.3,.5,.3,.5,.3,.3,.5,.5,.5,.5,.5,.5,.5,.3,-.5,-.5,-.5,-.3,-.5,-.5,-.3,-.3,-.5,-.5,-.3,-.5,-.5,-.5,-.5,-.5,-.5,-.3,-.5,-.3,-.3,-.5,-.3,-.5,-.5,-.5,-.5,-.3,-.5,-.5,-.3,-.5,-.3,-.5,-.5,-.3,.3,-.5,-.5,.5,-.5,-.5,.5,-.3,-.5,.3,-.3,-.5,.5,-.5,-.5,.5,-.3,-.5,.5,-.3,-.3,.5,-.5,-.3,.3,-.5,-.5,.5,-.5,-.5,.5,-.5,-.3,.3,-.5,-.3,-.5,.3,-.5,-.3,.3,-.5,-.3,.5,-.5,-.5,.5,-.5,-.5,.3,-.5,-.5,.3,-.3,-.5,.5,-.3,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.3,-.3,.5,-.3,-.3,.5,-.5,.3,.3,-.5,.5,.3,-.5,.5,.5,-.5,.3,.5,-.5,.5,.3,-.5,.5,.5,-.5,.5,.5,-.3,.5,.3,-.3,.3,.5,-.5,.3,.5,-.3,.5,.5,-.3,.5,.5,-.5,.3,-.3,.5,.5,-.3,.5,.5,.3,.5,.3,.3,.5,.5,-.3,.3,.5,.3,.3,.5,.3,.5,.5,-.3,.5,-.5,-.3,.5,-.3,-.3,.5,-.3,.3,.5,-.5,.3,.5,-.5,-.3,.3,-.5,-.3,.5,-.5,.3,.5,-.5,.3,.3,-.3,-.5,.5,.3,-.5,.5,.3,-.3,.5,-.3,-.3,.5,-.3,-.5,.3,.3,-.5,.3,.3,-.5,.5,-.3,-.5,.5,-.3,.3,.5,.3,.3,.5,.3,.5,.5,-.3,.5,.5,-.3,.5,.3,-.3,.5,.5,.3,.5,.5,.3,.5,.3,.3,-.3,-.5,.5,-.3,-.5,.5,.3,-.5,.3,.3,-.5,.5,-.3,-.5,.5,.3,-.5,.5,.3,-.3,.5,-.3,-.3,-.5,-.3,-.5,-.5,.3,-.5,-.3,.3,-.5,-.3,-.3,-.5,-.5,-.3,-.5,-.5,-.3,-.3,-.5,.3,-.3,-.5,.3,-.5,-.3,-.5,-.5,.3,-.5,-.5,.3,-.3,-.5,-.3,-.3,-.5,-.3,-.5,-.5,.3,-.5,-.5,.3,-.5,-.3,-.3,-.5,-.3,-.3,.3,-.5,.3,.3,-.5,.3,.5,-.5,-.3,.5,-.5,-.3,.5,-.5,-.3,.5,-.3,.3,.5,-.3,.3,.5,-.5,.3,-.5,-.3,.5,-.5,-.3,.5,-.5,.3,.3,-.5,.3,.5,-.5,-.3,.5,-.3,-.3,.5,-.3,.3,.5,-.5,.3,-.5,-.5,-.3,-.3,-.5,-.3,-.3,-.5,.3,-.5,-.5,.3,-.5,-.5,-.3,-.5,-.5,.3,-.5,-.3,.3,-.5,-.3,-.3,.3,.5,-.3,.3,.5,.3,.5,.5,.3,.5,.5,-.3,.5,.3,-.3,.5,.5,-.3,.5,.5,.3,.5,.3,.3,-.5,.5,-.3,-.5,.5,.3,-.3,.5,.3,-.3,.5,-.3,-.5,.3,-.3,-.5,.3,.3,-.5,.5,.3,-.5,.5,-.3]),this.indices=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23,24,25,26,24,26,27,28,29,30,28,30,31,32,33,34,32,34,35,36,37,38,36,38,39,40,41,42,40,42,43,44,45,46,44,46,47,48,49,50,48,50,51,52,53,54,52,54,55,56,57,58,56,58,59,60,61,62,60,62,63,64,65,66,64,66,67,68,69,70,68,70,71,72,74,73,72,75,74,76,77,78,76,78,79,80,81,82,80,82,83,84,86,85,84,87,86,88,89,90,88,90,91,92,93,94,92,94,95,96,98,97,96,99,98,100,101,102,100,102,103,104,105,106,104,106,107,108,110,109,108,111,110,112,113,114,112,114,115,116,117,118,116,118,119,120,121,122,120,122,123,124,125,126,124,126,127,128,129,130,128,130,131,132,133,134,132,134,135,136,137,138,136,138,139,140,141,142,140,142,143,144,145,146,144,146,147,148,149,150,148,150,151,152,154,153,152,155,154,156,157,158,156,158,159,160,161,162,160,162,163,164,165,166,164,166,167,168,170,169,168,171,170,172,173,174,172,174,175,176,178,177,176,179,178,180,181,182,180,182,183,184,185,186,184,186,187,188,189,190,188,190,191,192,193,194,192,194,195,196,197,198,196,198,199,200,201,202,200,202,203,204,205,206,204,206,207,208,209,210,208,210,211,212,213,214,212,214,215]),this.txtCoords=new Float32Array([1/3+1/15,0+1/15,.6,0+1/15,.6,1/3-1/15,1/3+1/15,1/3-1/15,1-1/15,0+1/15,1-1/15,1/3-1/15,2/3+1/15,1/3-1/15,2/3+1/15,0+1/15,2/3+1/15,1/3+1/15,1-1/15,1/3+1/15,1-1/15,.6,2/3+1/15,.6,0+1/15,1/3-1/15,0+1/15,0+1/15,1/3-1/15,0+1/15,1/3-1/15,1/3-1/15,0+1/15,1/3+1/15,1/3-1/15,1/3+1/15,1/3-1/15,.6,0+1/15,.6,.6,1/3+1/15,.6,.6,1/3+1/15,.6,1/3+1/15,1/3+1/15,.7,1/3+1/30,.7,1/3+1/30,.7,1/3+1/30,.7,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,.7,1/3+1/30,.7,1/3+1/30,.7,1/3+1/30,.7,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,.7,1/3+1/30,.7,1/3+1/30,.7,1/3+1/30,.7,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,.7,1/30,.7,1/30,.7,1/30,.7,1/30,.7,1/3+1/30,.7,1/3+1/30,.7,1/3+1/30,.7,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,.7,1/30,.7,1/30,.7,1/30,.7,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,1/3+1/30,.7,1/30,.7,1/30,.7,1/30,.7,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,1/30,1/3+1/30,.7,1/30,.7,1/30,.7,1/30,.7,1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,1/3+2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/3+1/30,2/3+2/30,1/30,2/3+2/30,1/30,2/3+2/30,1/30,2/3+2/30,1/30,2/30,1/30,2/30,1/30,2/30,1/30,2/30,1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/30,1/30,2/30,1/30,2/30,1/30,2/30,1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,2/30,1/30,2/30,1/30,2/30,1/30,2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/30,2/30,1/30,2/30,1/30,2/30,1/30,2/30,1/30,2/3+2/30,1/30,2/3+2/30,1/30,2/3+2/30,1/30,2/3+2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/30,1/3+1/30,1/3+2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,2/3+2/30,1/30,2/3+2/30,1/30,2/3+2/30,1/30,2/3+2/30,1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/30,1/3+1/30,2/3+2/30,1/30,2/3+2/30,1/30,2/3+2/30,1/30,2/3+2/30,1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30,1/3+2/30,1/3+1/30]),this._image=t}return t.prototype.init=function(t){var e=this;this.viewer=t;var i=this.viewer._gl;this._shader=null,this._initShader(),this._alpha=this.passiveAlpha,this._selection=0,i.useProgram(this._shader),this._pMatrixUniformPointer=i.getUniformLocation(this._shader,"uPMatrix"),this._rotationUniformPointer=i.getUniformLocation(this._shader,"uRotation"),this._colourCodingUniformPointer=i.getUniformLocation(this._shader,"uColorCoding"),this._alphaUniformPointer=i.getUniformLocation(this._shader,"uAlpha"),this._selectionUniformPointer=i.getUniformLocation(this._shader,"uSelection"),this._textureUniformPointer=i.getUniformLocation(this._shader,"uTexture"),this._highlightingUniformPointer=i.getUniformLocation(this._shader,"uHighlighting"),this._vertexAttrPointer=i.getAttribLocation(this._shader,"aVertex"),this._texCoordAttrPointer=i.getAttribLocation(this._shader,"aTexCoord"),this._idAttrPointer=i.getAttribLocation(this._shader,"aId"),i.enableVertexAttribArray(this._vertexAttrPointer),i.enableVertexAttribArray(this._texCoordAttrPointer),i.enableVertexAttribArray(this._idAttrPointer),this._indexBuffer=i.createBuffer(),this._vertexBuffer=i.createBuffer(),this._texCoordBuffer=i.createBuffer(),this._idBuffer=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this._texCoordBuffer),i.bufferData(i.ARRAY_BUFFER,this.txtCoords,i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this._idBuffer),i.bufferData(i.ARRAY_BUFFER,this.ids(),i.STATIC_DRAW);var e=this;if(this._texture=i.createTexture(),"undefined"==typeof this._image){var n=r.xCubeTextures.en,a=new Image;e._image=a,a.addEventListener("load",function(){i.bindTexture(i.TEXTURE_2D,e._texture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e._image),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)}),a.src=n}else i.bindTexture(i.TEXTURE_2D,e._texture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e._image),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D);i.useProgram(this.viewer._shaderProgram),t._canvas.addEventListener("mousemove",function(i){var r=i.clientX,n=i.clientY,a=t._canvas.getBoundingClientRect(),o=r-a.left,s=t._height-(n-a.top),u=t._getID(o,s);u>=e.TOP&&u<=e.BACK_LEFT?(e._alpha=e.activeAlpha,e._selection=u):(e._alpha=e.passiveAlpha,e._selection=0)},!0),e._drag=!1,t._canvas.addEventListener("mousedown",function(i){var r=i.clientX,n=i.clientY,a=t._canvas.getBoundingClientRect(),o=r-a.left,s=t._height-(n-a.top),u=t._getID(o,s);u>=e.TOP&&u<=e.BACK_LEFT&&(e._drag=!0,e._originalNavigation=t.navigationMode,t.navigationMode="orbit")},!0),window.addEventListener("mouseup",function(i){e._drag===!0&&(t.navigationMode=e._originalNavigation),e._drag=!1},!0),this._initialized=!0},t.prototype.onBeforeDraw=function(){},t.prototype.onBeforePick=function(t){if(t>=this.TOP&&t<=this.BACK_LEFT){var e=a.vec3.create(),i=this.viewer._distance,r=1.3;switch(t){case this.TOP:return this.viewer.show("top"),!0;case this.BOTTOM:return this.viewer.show("bottom"),!0;case this.LEFT:return this.viewer.show("left"),!0;case this.RIGHT:return this.viewer.show("right"),!0;case this.FRONT:return this.viewer.show("front"),!0;case this.BACK:return this.viewer.show("back"),!0;case this.TOP_LEFT_FRONT:e=a.vec3.fromValues(-1,-1,1),i*=r;break;case this.TOP_RIGHT_FRONT:e=a.vec3.fromValues(1,-1,1),i*=r;break;case this.TOP_LEFT_BACK:e=a.vec3.fromValues(-1,1,1),i*=r;break;case this.TOP_RIGHT_BACK:e=a.vec3.fromValues(1,1,1),i*=r;break;case this.BOTTOM_LEFT_FRONT:e=a.vec3.fromValues(-1,-1,-1),i*=r;break;case this.BOTTOM_RIGHT_FRONT:e=a.vec3.fromValues(1,-1,-1),i*=r;break;case this.BOTTOM_LEFT_BACK:e=a.vec3.fromValues(-1,1,-1),i*=r;break;case this.BOTTOM_RIGHT_BACK:e=a.vec3.fromValues(1,1,-1),i*=r;break;case this.TOP_LEFT:e=a.vec3.fromValues(-1,0,1),i*=r;break;case this.TOP_RIGHT:e=a.vec3.fromValues(1,0,1),i*=r;break;case this.TOP_FRONT:e=a.vec3.fromValues(0,-1,1),i*=r;break;case this.TOP_BACK:e=a.vec3.fromValues(0,1,1),i*=r;break;case this.BOTTOM_LEFT:e=a.vec3.fromValues(-1,0,-1),i*=r;break;case this.BOTTOM_RIGHT:e=a.vec3.fromValues(1,0,-1);break;case this.BOTTOM_FRONT:e=a.vec3.fromValues(0,-1,-1),i*=r;break;case this.BOTTOM_BACK:e=a.vec3.fromValues(0,1,-1),i*=r;break;case this.FRONT_RIGHT:e=a.vec3.fromValues(1,-1,0),i*=r;break;case this.FRONT_LEFT:e=a.vec3.fromValues(-1,-1,0),i*=r;break;case this.BACK_RIGHT:e=a.vec3.fromValues(1,1,0),i*=r;break;case this.BACK_LEFT:e=a.vec3.fromValues(-1,1,0),i*=r}var n=this.viewer._origin,o=a.vec3.fromValues(0,0,1),s=a.vec3.fromValues(n[0],n[1],n[2]);e=a.vec3.normalize(a.vec3.create(),e);var u=a.vec3.scale(a.vec3.create(),e,i),l=a.vec3.add(a.vec3.create(),s,u);return a.mat4.lookAt(this.viewer._mvMatrix,l,s,o),!0}return!1},t.prototype.onAfterDraw=function(){var t=this.setActive();t.uniform1i(this._colourCodingUniformPointer,0),this.draw(),this.setInactive()},t.prototype.onBeforeDrawId=function(){},t.prototype.onAfterDrawId=function(){var t=this.setActive();t.uniform1i(this._colourCodingUniformPointer,1),this.draw(),this.setInactive()},t.prototype.onBeforeGetId=function(t){},t.prototype.setActive=function(){var t=this.viewer._gl;return t.useProgram(this._shader),t},t.prototype.setInactive=function(){var t=this.viewer._gl;t.useProgram(this.viewer._shaderProgram)},t.prototype.draw=function(){if(this._initialized){var t=this.viewer._gl,e=a.mat4.create(),i=1/this.ratio,r=i/this.viewer._height*this.viewer._width;switch(this.position){case this.BOTTOM_RIGHT:a.mat4.ortho(e,(this.ratio-1)*r,this.ratio*r,this.ratio*-1*i,(1-this.ratio)*i,-1,1);break;case this.BOTTOM_LEFT:a.mat4.ortho(e,-1*this.ratio*r,(1-this.ratio)*r,this.ratio*-1*i,(1-this.ratio)*i,-1,1);break;case this.TOP_LEFT:a.mat4.ortho(e,-1*this.ratio*r,(1-this.ratio)*r,(this.ratio-1)*i,this.ratio*i,-1,1);break;case this.TOP_RIGHT:a.mat4.ortho(e,(this.ratio-1)*r,this.ratio*r,(this.ratio-1)*i,this.ratio*i,-1,1)}var n=a.mat3.fromMat4(a.mat3.create(),this.viewer._mvMatrix);t.uniformMatrix4fv(this._pMatrixUniformPointer,!1,e),t.uniformMatrix3fv(this._rotationUniformPointer,!1,n),t.uniform1f(this._alphaUniformPointer,this._alpha),t.uniform1f(this._highlightingUniformPointer,this.highlighting),t.uniform1f(this._selectionUniformPointer,this._selection),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.vertexAttribPointer(this._vertexAttrPointer,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._idBuffer),t.vertexAttribPointer(this._idAttrPointer,1,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordBuffer),t.vertexAttribPointer(this._texCoordAttrPointer,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._texture),t.uniform1i(this._textureUniformPointer,1);var o=t.getParameter(t.CULL_FACE);o||t.enable(t.CULL_FACE),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0),o||t.disable(t.CULL_FACE)}},t.prototype._initShader=function(){var t=this.viewer._gl,e=this.viewer,i=function(i,r){if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))return e._error(t.getShaderInfoLog(i)),null},r=t.createShader(t.FRAGMENT_SHADER);i(r,n.xCubeShaders.cube_fshader);var a=t.createShader(t.VERTEX_SHADER);i(a,n.xCubeShaders.cube_vshader),this._shader=t.createProgram(),t.attachShader(this._shader,a),t.attachShader(this._shader,r),t.linkProgram(this._shader),t.getProgramParameter(this._shader,t.LINK_STATUS)||e._error("Could not initialise shaders for a navigation cube plugin")},t.prototype.ids=function(){return new Float32Array([this.FRONT,this.FRONT,this.FRONT,this.FRONT,this.BACK,this.BACK,this.BACK,this.BACK,this.TOP,this.TOP,this.TOP,this.TOP,this.BOTTOM,this.BOTTOM,this.BOTTOM,this.BOTTOM,this.RIGHT,this.RIGHT,this.RIGHT,this.RIGHT,this.LEFT,this.LEFT,this.LEFT,this.LEFT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_LEFT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_RIGHT_FRONT,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_LEFT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.TOP_RIGHT_BACK,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_LEFT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_RIGHT_FRONT,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_LEFT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.BOTTOM_RIGHT_BACK,this.TOP_RIGHT,this.TOP_RIGHT,this.TOP_RIGHT,this.TOP_RIGHT,this.TOP_RIGHT,this.TOP_RIGHT,this.TOP_RIGHT,this.TOP_RIGHT,this.TOP_LEFT,this.TOP_LEFT,this.TOP_LEFT,this.TOP_LEFT,this.TOP_LEFT,this.TOP_LEFT,this.TOP_LEFT,this.TOP_LEFT,this.TOP_FRONT,this.TOP_FRONT,this.TOP_FRONT,this.TOP_FRONT,this.TOP_FRONT,this.TOP_FRONT,this.TOP_FRONT,this.TOP_FRONT,this.TOP_BACK,this.TOP_BACK,this.TOP_BACK,this.TOP_BACK,this.TOP_BACK,this.TOP_BACK,this.TOP_BACK,this.TOP_BACK,this.BOTTOM_RIGHT,this.BOTTOM_RIGHT,this.BOTTOM_RIGHT,this.BOTTOM_RIGHT,this.BOTTOM_RIGHT,this.BOTTOM_RIGHT,this.BOTTOM_RIGHT,this.BOTTOM_RIGHT,this.BOTTOM_LEFT,this.BOTTOM_LEFT,this.BOTTOM_LEFT,this.BOTTOM_LEFT,this.BOTTOM_LEFT,this.BOTTOM_LEFT,this.BOTTOM_LEFT,this.BOTTOM_LEFT,this.BOTTOM_FRONT,this.BOTTOM_FRONT,this.BOTTOM_FRONT,this.BOTTOM_FRONT,this.BOTTOM_FRONT,this.BOTTOM_FRONT,this.BOTTOM_FRONT,this.BOTTOM_FRONT,this.BOTTOM_BACK,this.BOTTOM_BACK,this.BOTTOM_BACK,this.BOTTOM_BACK,this.BOTTOM_BACK,this.BOTTOM_BACK,this.BOTTOM_BACK,this.BOTTOM_BACK,this.FRONT_RIGHT,this.FRONT_RIGHT,this.FRONT_RIGHT,this.FRONT_RIGHT,this.FRONT_RIGHT,this.FRONT_RIGHT,this.FRONT_RIGHT,this.FRONT_RIGHT,this.FRONT_LEFT,this.FRONT_LEFT,this.FRONT_LEFT,this.FRONT_LEFT,this.FRONT_LEFT,this.FRONT_LEFT,this.FRONT_LEFT,this.FRONT_LEFT,this.BACK_RIGHT,this.BACK_RIGHT,this.BACK_RIGHT,this.BACK_RIGHT,this.BACK_RIGHT,this.BACK_RIGHT,this.BACK_RIGHT,this.BACK_RIGHT,this.BACK_LEFT,this.BACK_LEFT,this.BACK_LEFT,this.BACK_LEFT,this.BACK_LEFT,this.BACK_LEFT,this.BACK_LEFT,this.BACK_LEFT])},t}();e.xNavigationCube=o},function(t,e){"use strict";e.xHomeTextures={en:"data:image/png;base64,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SsR29L9i99nLfjBJ0+QW4Niu1q8u94GWHaMS8Uz6W/d7LHeMpKn0Bfpb/59fzoMs6wJ2iTgcuBVDJM2zPYBbhx4s2ZJjVCJOAD4JbLucAZJmwrbAJ4cuLMmSYlQi3gZcCKxa6hNLmjmrgAuHPizaoq4ZlYgNgQ8CY/k5A0kz40zg9K7WRxf6BxYcoxKxOf2tvLH9BKakmfJ3wAldrd9ayAcvKEYlYifgSmCsZ1MkzZx/AY7qav3v9X3geq8ZlYj96Q+7GiJJi3Ug/SHb/df3geuMUYl4Pv1h151HNEzS/NmZ/pDtOt/P7EljVCJeR/9Psy1GPEzS/NkCuHLoylo94ZrRcNj194GJvweupLnwHuC3fviQ7eNiVCJWAn8NNPntAJLmxgXAq7taH/q///H9GJWIbYDLgOe02SZpzqwBjutq/ToMMSoRu9Mfdt2r6TRJ8+Yu+kO298S/wmHA5cD2jUdJmk9fAY7ZCHiM6XtDtOcBv916hJTUu4HrW49YpMc26mr9+9YrFqtE7Nh6g5TYnV2tN7QesVgT//XWkrQ2xkhSCsZIUgrGSFIKxkhSCsZIUgrGSFIKxkhSCsZIUgrGSFIKxkhSChu1HpDdhltuCRGtZ0xcffRRHnvggZE/7garVxMbbjjyx02vVh69//7WK1IzRuux1333EStXtp4xcQ/ecQd3Hzj6Xwiz25o1rDrggJE/bnb1oYe4c5W/gHld/GeapBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFIyRpBSMkaQUjJGkFDZqPSC7r51xBrFiResZE/fIvfeO5XHvP/98vn3DDWN57Mzqww+3npBe1Fpbb1i0EnEScEHrHVJSJ3e1Xth6xGL5zzRJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKRgjSSkYI0kpGCNJKfwvQct8OdSrePoAAAAASUVORK5CYII="}},function(t,e,i){"use strict";var r=i(17),n=i(11),a=function(){function t(t){this.ratio=.2,this.placementX=.05,this.placementY=.05,this.activeAlpha=1,this.passiveAlpha=.3,this.distance=null,this.viewDirection=[1,1,-1],this._image=t}return t.prototype.init=function(t){this._viewer=t;var e=this;if("undefined"==typeof this._image){var i=r.xHomeTextures.en,a=new Image;e._image=a,a.addEventListener("load",function(){e._adjust()}),a.src=i}else e._adjust();document.documentElement.appendChild(this._image),e._image.addEventListener("click",function(){var t=e._viewer;t.setCameraTarget();var i=(t._origin,null!=e.distance?e.distance:t._distance),r=n.vec3.normalize(n.vec3.create(),e.viewDirection),a=n.vec3.scale(n.vec3.create(),r,-1*i);t.setCameraPosition(a)}),e._image.addEventListener("mouseover",function(){e._image.style.opacity=e.activeAlpha.toString(),e._image.style.filter="alpha(opacity="+Math.round(100*e.activeAlpha)+")"}),e._image.addEventListener("mouseleave",function(){e._image.style.opacity=e.passiveAlpha.toString(),e._image.style.filter="alpha(opacity="+Math.round(100*e.passiveAlpha)+")"}),e._image.style.opacity=this.passiveAlpha.toString(),e._image.style.filter="alpha(opacity="+Math.round(100*this.passiveAlpha)+")"},t.prototype._adjust=function(){function t(t){var e=t.getBoundingClientRect(),i=document.body,r=document.documentElement,n=window.pageYOffset||r.scrollTop||i.scrollTop,a=window.pageXOffset||r.scrollLeft||i.scrollLeft,o=r.clientTop||i.clientTop||0,s=r.clientLeft||i.clientLeft||0,u=Math.round(e.top+n-o),l=Math.round(e.left+a-s),A=Math.round(e.width),c=Math.round(e.height);return{top:u,left:l,width:A,height:c}}var e=this._viewer._canvas,i=t(e);this._image.style.width=Math.round(i.height*this.ratio)+"px",this._image.style.height=Math.round(i.height*this.ratio)+"px",this._image.style.position="absolute",this._image.style.left=Math.round(i.left+i.width*this.placementX)+"px",this._image.style.top=Math.round(i.top+i.height*this.placementY)+"px"},t.prototype.onBeforeDraw=function(){},t.prototype.onBeforePick=function(t){},t.prototype.onAfterDraw=function(){this._adjust()},t.prototype.onBeforeDrawId=function(){},t.prototype.onAfterDrawId=function(){},t.prototype.onBeforeGetId=function(t){},t.prototype.draw=function(){},t}();e.xNavigationHome=a},function(t,e,i){(function(t){t.xAttributeDictionary=t.xAttributeDictionary?t.xAttributeDictionary:i(20).xAttributeDictionary,t.xBrowser=t.xBrowser?t.xBrowser:i(21).xBrowser,t.xCobieUtils=t.xCobieUtils?t.xCobieUtils:i(29).xCobieUtils,t.xCobieUkUtils=t.xCobieUkUtils?t.xCobieUkUtils:i(24).xCobieUkUtils,t.xVisualAssignmentSet=t.xVisualAssignmentSet?t.xVisualAssignmentSet:i(26).xVisualAssignmentSet,t.xVisualAttribute=t.xVisualAttribute?t.xVisualAttribute:i(27).xVisualAttribute,t.xVisualEntity=t.xVisualEntity?t.xVisualEntity:i(25).xVisualEntity,t.xVisualModel=t.xVisualModel?t.xVisualModel:i(23).xVisualModel,t.xVisualProperty=t.xVisualProperty?t.xVisualProperty:i(28).xVisualProperty,t.xVisualTemplates=t.xVisualTemplates?t.xVisualTemplates:i(22).xVisualTemplates}).call(e,function(){return this}())},function(t,e){"use strict";var i=function(){function t(t,e){var i=[{lang:"cs",culture:"cz",terms:{AssetDescription:"Popis",AssetInstallationDate:"Datum instalace",AssetName:"Název",AssetSerialNumber:"Sériové číslo",AssetTypeCategory:"Kategorie",AssetTypeColorCode:"Kód barvy",AssetTypeDescription:"Popis",AssetTypeFeaturesDescription:"Popis vlastností",AssetTypeGradeDescription:"Popis kvality",AssetTypeMaterialDescription:"Popis materiálu",AssetTypeName:"Název",AssetTypeShapeDescription:"Popis tvaru",AssetTypeSizeDescription:"Popis velikosti",AssetWarrantyStartDate:"Začátek záruky",AttributeCategory:"Kategorie",AttributeDescription:"Popis",AttributeName:"Název",FacilityCategory:"Kategorie",FacilityDefaultAreaUnit:"Předdefinovaná jednotka plochy",FacilityDefaultLinearUnit:"Předdefinovaná jednotka délky",FacilityDefaultVolumeUnit:"Předdefinovaná jednotka objemu",FacilityDeliverablePhaseName:"Název fáze výsledku",FacilityDescription:"Popis nemovitosti",FacilityName:"Název",FloorCategory:"Kategorie",FloorDescription:"Popis",FloorName:"Název",ProjectDescription:"Popis projektu",ProjectName:"Název projektu",SiteDescription:"Popis stavby",SpaceCategory:"Kategorie místnosti",SpaceDescription:"Popis místnosti",SpaceName:"Název místnosti",SpaceSignageName:"Space Signage Name",StringValue:"String Value",SystemCategory:"System Category",SystemDescription:"System Description",SystemName:"System Name",UnitName:"Unit Name",ZoneCategory:"Zone Category",ZoneDescription:"Zone Description",ZoneName:"Zone Name",externalID:"External ID",externalIDReference:"External ID Reference",propertySetName:"Property Set",True:"Ano",False:"Ne"}},{lang:"en",culture:"uk",terms:{AssetDescription:"Asset Description",AssetInstallationDate:"Asset Installation Date",AssetName:"Asset Name",AssetSerialNumber:"Asset Serial Number",AssetTypeCategory:"Asset Type Category",AssetTypeColorCode:"Asset Type Color Code",AssetTypeDescription:"Asset Type Description",AssetTypeFeaturesDescription:"Asset Type Features Description",AssetTypeGradeDescription:"Asset Type Grade Description",AssetTypeMaterialDescription:"Asset Type Material Description",AssetTypeName:"Asset Type Name",AssetTypeShapeDescription:"Asset Type Shape Description",AssetTypeSizeDescription:"Asset Type Size Description",AssetWarrantyStartDate:"Asset Warranty Start Date",AttributeCategory:"Attribute Category",AttributeDescription:"Attribute Description",AttributeName:"Attribute Name",FacilityCategory:"Facility Category",FacilityDefaultAreaUnit:"Facility Default Area Unit",FacilityDefaultLinearUnit:"Facility Default Linear Unit",FacilityDefaultVolumeUnit:"Facility Default Volume Unit",FacilityDeliverablePhaseName:"Facility Deliverable Phase Name",FacilityDescription:"Facility Description",FacilityName:"Facility Name",FloorCategory:"Floor Category",FloorDescription:"Floor Description",FloorName:"Floor Name",ProjectDescription:"Project Description",ProjectName:"Project Name",SiteDescription:"Site Description",SpaceCategory:"Space Category",SpaceDescription:"Space Description",SpaceName:"Space Name",SpaceSignageName:"Space Signage Name",StringValue:"String Value",SystemCategory:"System Category",SystemDescription:"System Description",SystemName:"System Name",UnitName:"Unit Name",ZoneCategory:"Zone Category",ZoneDescription:"Zone Description",ZoneName:"Zone Name",externalID:"External ID",externalIDReference:"External ID Reference",propertySetName:"Property Set",True:"True",False:"False"}}],r=i.filter(function(t){return"en"==t.lang&&"uk"==t.culture})[0].terms;if("undefined"==typeof t&&"undefined"==typeof e)return r;var n=i.filter(function(e){return e.lang==t});if(0==n.length)return r;if(1==n.length||"undefined"==typeof e)return n[0].terms;var a=n.filter(function(t){return t.culture==e});return 1==a.length?a[0].terms:n[0].terms}return t}();e.xAttributeDictionary=i},function(t,e,i){"use strict";var r=i(22),n=i(23),a=i(24),o=i(29),s=function(){function t(t,e){this._iconMap={def:"ui-icon-document",facility:"ui-icon-home",space:"ui-icon-document-b",floor:"ui-icon-image",assettype:"ui-icon-copy",asset:"ui-icon-script",document:"ui-icon-document",issue:"ui-icon-clipboard",contact:"ui-icon-person",system:"ui-icon-wrench",zone:"ui-icon-newwin"},this._model=new n.xVisualModel(null),this._events=[],this._templates={},this._lang=t,this._culture=e,this._templates={};var i=r.xVisualTemplates();for(var a in i){var o=i[a];this._templates[a]=this._compileTemplate(o)}}return t.prototype._compileTemplate=function(t){
return new Function("_data_","var _p_=[],print=function(){_p_.push.apply(_p_,arguments);};with(_data_){_p_.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("_p_.push('").split("\r").join("\\'")+"');}return _p_.join('');")},t.prototype.renderSpatialStructure=function(t,e){if(!this._model)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';this._renderTreeView(t,this._model.facility,e)},t.prototype.renderAssetTypes=function(t,e){if(!this._model)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';this._renderTreeView(t,this._model.assetTypes,e)},t.prototype.renderContacts=function(t){if(!this._model)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';this._renderListView(t,this._model.contacts,this._templates.contact)},t.prototype.renderSystems=function(t,e){if(!this._model)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';this._renderTreeView(t,this._model.systems,e)},t.prototype.renderZones=function(t,e){if(!this._model)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';this._renderTreeView(t,this._model.zones,e)},t.prototype.renderAssignments=function(t,e){if(!this._model)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';e=this._getContainer(e),e.innerHTML="";var i=t.assignments;if(0!=i.length)for(var r=0;r<i.length;r++){var n=i[r];if(0!=n.assignments.length){var a=document.createElement("div");a.classList.add("xbim-assignment"),a.classList.add("ui-widget"),a.classList.add("ui-corner-all"),a.classList.add("ui-widget-content");var o=document.createElement("h3");o.classList.add("xbim-assignment-header"),o.classList.add("ui-corner-all"),o.classList.add("ui-widget-header"),o.classList.add("ui-state-default"),o.innerHTML=n.name?n.name:"Undefined",a.appendChild(o);var s=document.createElement("div");s.classList.add("xbim-assignment-content"),this._renderListView(s,n.assignments),a.appendChild(s),e.appendChild(a)}}},t.prototype.renderDocuments=function(t,e){if(!t)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';e=this._getContainer(e);var i=t.documents;i&&this._renderListView(e,i,null)},t.prototype.renderIssues=function(t,e){if(!t)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';e=this._getContainer(e);var i=t.issues;i&&this._renderListView(e,i,null)},t.prototype.renderAttributes=function(t,e){if(!t)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';var i=this;e=this._getContainer(e);var r=i._templates.attribute(t);e.innerHTML=r},t.prototype.renderProperties=function(t,e){if(!t)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';var i=this;e=this._getContainer(e);var r=i._templates.property(t);e.innerHTML=r},t.prototype.renderPropertiesAttributes=function(t,e){if(!t)throw'No data to be rendered. Use this function in an event handler of "loaded" event.';var i=this;e=this._getContainer(e);var r=i._templates.propertyattribute(t);e.innerHTML=r},t.prototype._registerEntityCallBacks=function(t,e){var i=this;t.entity=e,t.addEventListener("click",function(r){i._fire("entityClick",{entity:e,event:r,element:t}),i._fire("entityActive",{entity:e,event:r,element:t}),r.stopPropagation()}),t.addEventListener("dblclick",function(r){i._fire("entityDblclick",{entity:e,event:r,element:t}),i._fire("entityActive",{entity:e,event:r,element:t}),r.stopPropagation()}),t.addEventListener("mouseDown",function(r){i._fire("entityMouseDown",{entity:e,event:r,element:t}),r.stopPropagation()}),t.addEventListener("mouseUp",function(r){i._fire("entityMouseUp",{entity:e,event:r,element:t}),r.stopPropagation()}),t.addEventListener("mouseMove",function(r){i._fire("entityMouseMove",{entity:e,event:r,element:t}),r.stopPropagation()}),t.addEventListener("touch",function(r){i._fire("entityTouch",{entity:e,event:r,element:t}),r.stopPropagation()})},t.prototype._uiTree=function(t){if(t&&jQuery&&jQuery.ui){var e="string"==typeof t?$("#"+t):$(t),i="string"==typeof t?$("#"+t+" li"):$(t).find("li");if(!e.hasClass("xbim-tree")){e.addClass("xbim-tree");var r="ui-icon-triangle-1-s",n="ui-icon-triangle-1-e";i.prepend(function(){return $(this).children("ul").length>0?($(this).addClass("xbim-tree-node"),'<span class="ui-icon '+n+'" style="float: left;"></span>'):($(this).addClass("xbim-tree-leaf"),"")}).css("list-style-type","none").css("cursor","default").children("ul").hide(),i.find("span."+n).on("click",function(t){t.stopPropagation(),$(this).parent().children("ul").slideToggle(),$(this).hasClass(n)?$(this).removeClass(n).addClass(r):$(this).removeClass(r).addClass(n)});var a=e.children("ul").children("li");1==a.length&&a.children("span."+n).click()}}},t.prototype._renderListView=function(t,e,i){var r=this;t=this._getContainer(t),i=i?i:r._templates.entity;var n=document.createElement("table");t.innerHTML="",t.appendChild(n);for(var a=0;a<e.length;a++){var o=e[a],s=i(o),u=document.createElement("tr");n.appendChild(u);var l=document.createElement("td");if(u.appendChild(l),l.innerHTML=s,this._registerEntityCallBacks(l,o),jQuery&&jQuery.ui){var A=this._iconMap[o.type]?this._iconMap[o.type]:this._iconMap.def;$(l).prepend('<span class="ui-icon '+A+'" style="float: left;"></span>')}}},t.prototype._renderTreeView=function(t,e,i,r){var n=this;t=this._getContainer(t),r=r?r:n._templates.entity,i=!i||i;var a=function(e,i){for(var o=0;o<e.length;o++){var s=e[o],u=r(s),l=document.createElement("li");if(l.innerHTML=u,n._registerEntityCallBacks(l,s),!i){var i=document.createElement("ul");t.appendChild(i)}if(i.appendChild(l),s.children&&s.children.length>0){var A=document.createElement("ul");l.appendChild(A),a(s.children,A)}if(jQuery&&jQuery.ui){var c=n._iconMap[s.type]?n._iconMap[s.type]:n._iconMap.def;$(l).prepend('<span class="ui-icon '+c+'" style="float: left;"></span>')}}};a(e),i&&this._uiTree(t)},t.prototype.activateEntity=function(t){if(this._model){var e=this._model.getEntity(t);e&&this._fire("entityActive",{entity:e})}},t.prototype._getContainer=function(t){return"object"==typeof t?t:"string"==typeof t&&(t=document.getElementById(t))?t:t?void 0:document.documentElement},t.prototype.load=function(t){if("undefined"==typeof t)throw"You have to define a source to JSON data.";var e=this;if(t instanceof Blob||t instanceof File){var i=new FileReader;return i.onloadend=function(){if(i.result){var t=JSON.parse(i.result),r="undefined"==typeof t.FacilityDefaultLinearUnit,n=r?new a.xCobieUkUtils(e._lang,e._culture):new o.xCobieUtils(e._lang,e._culture);e._model=n.getVisualModel(t),e._fire("loaded",{model:e._model})}},void i.readAsText(t)}if("string"!=typeof t)throw"Unexpected type of source. It should be File, Blob of string URL";var r=new XMLHttpRequest;r.open("GET",t,!0),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var t=r.response;"string"==typeof t&&(t=JSON.parse(t));var i="undefined"==typeof t.FacilityDefaultLinearUnit,n=i?new a.xCobieUkUtils(e._lang,e._culture):new o.xCobieUtils(e._lang,e._culture);e._model=n.getVisualModel(t),e._fire("loaded",{model:e._model})}if(4==r.readyState&&200!=r.status){var s="Failed to fetch semantic JSON data from server. Server code: "+r.status+". This might be due to CORS policy of your browser if you run this as a local file.";throw s}},r.responseType="json",r.send()},t.prototype.on=function(t,e){var i=this._events;i[t]||(i[t]=[]),i[t].push(e)},t.prototype.onRemove=function(t,e){var i=this._events,r=i[t];if(r){var n=r.indexOf(e);n>=0&&r.splice(n,1)}},t.prototype._fire=function(t,e){var i=this._events[t];i&&i.forEach(function(t){t(e)},this)},t}();e.xBrowser=s},function(t,e){"use strict";function i(){return{property:"<%if (properties && properties.length > 0) {%>\t<table> \t    <% for (var p in properties) { var prop = properties[p];%> \t    <tr> \t        <td><%=prop.name%></td>\t        <td><%=prop.value%></td>\t    </tr>\t    <%}%>\t</table> \t<%}%>",attribute:'<% if (attributes && attributes.length > 0) {\t    var psets = [];\t    for(var i = 0; i < attributes.length; i++){\t        var attr = attributes[i]; var pset = attr.propertySet; if (pset) {if(psets.indexOf(pset) == -1){psets.push(pset);}}\t    }\t%>\t<table> \t    <% for (var p in psets) { var psetName = psets[p]; var pset = attributes.filter(function(e){ return e.propertySet == psetName;});\t%>\t<tr><th colspan="2"><%=psetName%></th></tr>\t<%for (var a in pset) { var attr = pset[a];%> \t    <tr title="<%=attr.description%>"> \t        <td><%=attr.name%></td>\t        <td><%=attr.value%></td>\t    </tr>\t    <%}}%>\t</table>\t<%}%>',propertyattribute:'<%if (properties.length > 0 || attributes.length > 0) {%><table> \t    <% for (var p in properties) { var prop = properties[p];%> \t    <tr> \t        <td><%=prop.name%></td>\t        <td><%=prop.value%></td>\t    </tr>\t    <%}%>\t<%}\tif (attributes && attributes.length > 0) {\t    var psets = [];\t    for(var i = 0; i < attributes.length; i++){\t        var attr = attributes[i]; if (!attr.propertySet) attr.propertySet = "General";\t        var pset = attr.propertySet; if (pset) {if(psets.indexOf(pset) == -1){psets.push(pset);}}\t    }\t%>\t    <% for (var p in psets) { var psetName = psets[p]; var pset = attributes.filter(function(e){ return e.propertySet == psetName;});\t%>\t<tr><th colspan="2"><%=psetName%></th></tr>\t<%for (var a in pset) { var attr = pset[a];%> \t    <tr title="<%=attr.description%>"> \t        <td><%=attr.name%></td>\t        <td><%=attr.value%></td>\t    </tr>\t    <%}}%>\t</table>\t<%}%>',entity:'<span class="xbim-entity" title="<%=typeof(description) != "undefined" ? description : ""%>"> <%= name? name: (function f() { return type.charAt(0).toUpperCase() + type.slice(1); })() %> </span>',contact:'<% var nameA = properties.filter(function(e){return e.id == "ContactGivenName";})[0] || properties.filter(function(e){return e.id == "GivenName";})[0]; \tvar surnameA = properties.filter(function(e){return e.id == "ContactFamilyName";})[0] || properties.filter(function(e){return e.id == "FamilyName";})[0]; \tvar emailA = properties.filter(function(e){return e.id == "ContactEmail";})[0] || properties.filter(function(e){return e.id == "Email";})[0]; \tvar name = nameA ? nameA.value : "";\tvar surname = surnameA ? surnameA.value : "";\tvar email = emailA ? emailA.value : ""; %>\t<span class="xbim-entity" title="<%=email%>"> <%=name%> <%=surname%> <% if (!name && !surname) print("No name"); %> </span>'}}e.xVisualTemplates=i},function(t,e){"use strict";var i=function(){function t(t){if(this.facility=[],this.zones=[],this.systems=[],this.contacts=[],this.assetTypes=[],"object"==typeof t)for(var e in t)this[e]=t[e]}return t.prototype.getEntity=function(t){if("undefined"==typeof t||null==t)return null;t=t.toString();var e=function(t,i){for(var r=0;r<t.length;r++){var n=t[r];if(n.id==i)return n;var a=e(n.children,i);if(a)return a}return null};for(var i in this)if("function"!=typeof this[i]){var r=e(this[i],t);if(r)return r}return null},t}();e.xVisualModel=i},function(t,e,i){"use strict";var r=i(25),n=i(23),a=i(20),o=i(26),s=i(27),u=i(28),l=function(){function t(t,e){this._contacts=[],this.settings={decimalPlaces:4},this._dictionary=new a.xAttributeDictionary(t,e)}return t.prototype.getVisualEntity=function(t,e){if(!t||!e)throw"entity must be defined";return new r.xVisualEntity({id:t.ExternalId,type:e,name:this.getValidationStatus(t)+t.Name,description:t.Description,attributes:this.getAttributes(t),properties:this.getProperties(t),assignments:this.getAssignments(t,e),documents:this.getDocuments(t,e),issues:this.getIssues(t)})},t.prototype.getValidationStatus=function(t){if(null==t.Categories)return"";for(var e=0;e<t.Categories.length;e++){var i=t.Categories[e];if("undefined"!=typeof i.Code&&"failed"===i.Code.toLowerCase())return"[F] ";if("undefined"!=typeof i.Code&&"passed"===i.Code.toLowerCase())return"[T] "}return""},t.prototype.getVisualModel=function(t){if(!t)throw"data must be defined";this._contacts=this.getContacts(t);var e=this.getAssetTypes(t),i=this.getSpatialStructure(t,e);return new n.xVisualModel({facility:i,zones:this.getZones(t,i),systems:this.getSystems(t,e),assetTypes:e,contacts:this._contacts})},t.prototype.getContacts=function(t){if(!t)throw"data must be defined";var e=[],i=t.Contacts;if(!i)return e;for(var r=0;r<i.length;r++){var n=this.getVisualEntity(i[r],"contact");e.push(n)}return e},t.prototype.getSpatialStructure=function(t,e){if(!t)throw"data must be defined";if(!e)throw"types must be defined";var i=this.getVisualEntity(t,"facility"),r=t.Floors;if(!r||0==r.length)return[i];for(var n in r){var a=r[n],o=this.getVisualEntity(a,"floor");i.children.push(o);var s=a.Spaces;if(s)for(var u in s){var l=s[u],A=this.getVisualEntity(l,"space");o.children.push(A)}}for(var c in e){var h=e[c];for(var n in h.children){var f=h.children[n],d=f.assignments.filter(function(t){return"Space"==t.id})[0];if(d){var p=d.assignments[0];if(p){var m=p.properties.filter(function(t){return"Name"==t.id})[0];if(m)for(var g=m.value.split(",")[0],v=0;v<i.children.length;v++){var a=i.children[v],l=a.children.filter(function(t){return t.name==g})[0];if(l){l.children.push(f),d.assignments[0]=l;break}}}}}}return[i]},t.prototype.getZones=function(t,e){if(!t)throw"data must be defined";if(!e)throw"data must be defined";var i=[],r=t.Zones;if(!r)return i;for(var n in r){var a=r[n],s=this.getVisualEntity(a,"zone");i.push(s);var u=a.Spaces;if(u&&0!=u.length)for(var l in u)for(var A=u[l],c=0;c<e.length;c++)for(var h=e[c],f=0;f<h.children.length;f++)for(var d=h.children[f],p=0;p<d.children.length;p++){var m=d.children[p];if(m.name==A.Name){s.children.push(m);var g=m.assignments.filter(function(t){return"Zone"==t.id})[0];g||(g=new o.xVisualAssignmentSet,g.id="Zone",g.name="Zones",m.assignments.push(g)),g.assignments.push(s)}}}return i},t.prototype.getSystems=function(t,e){if(!t)throw"data must be defined";if(!e)throw"types must be defined";var i=[],r=t.Systems;if(!r)return i;for(var n=[],a=0;a<e.length;a++){var s=e[a];for(var u in s.children)n.push(s.children[u])}for(var l in r){var A=r[l],c=this.getVisualEntity(A,"system");i.push(c);for(var h=A.Components,f=0;f<h.length;f++){var d=h[f],p=n.filter(function(t){return t.name==d.Name});if(p){var m=p[0];if(m){c.children.push(m);var g=m.assignments.filter(function(t){return"System"==t.id})[0];g||(g=new o.xVisualAssignmentSet,g.id="System",g.Name="Systems",m.assignments.push(g)),g.assignments.push(c)}}}}return i},t.prototype.getAssetTypes=function(t){if(!t)throw"data must be defined";var e=[],i=this.getTranslator(),r=t.AssetTypes;if(!r)return e;for(var n in r){var a=r[n],s=this.getVisualEntity(a,"assettype");e.push(s);var u=a.Assets;if(u)for(var l in u){var A=u[l],c=this.getVisualEntity(A,"asset");s.children.push(c);var h=new o.xVisualAssignmentSet;h.id="AssetType",h.name=i(h.id),h.assignments.push(s),c.assignments.push(h)}}return e},t.prototype.getProperties=function(t){if(!t)throw"entity must be defined";var e=this.getTranslator(),i=[];for(var r in t){var n=t[r],a=this.getValueString(n);if(a){var o=e(r);i.push(new u.xVisualProperty({name:o,value:a,id:r}))}}for(var s=this.getCategoryProperties(t),l=0;l<s.length;l++)i.push(s[l]);return i},t.prototype.getCategoryProperties=function(t){var e=t.Categories;if(!e)return[];for(var i=[],r=0;r<e.length;r++){var n=e[r],a=n.Code+n.Description?": "+n.Description:"";i.push(new u.xVisualProperty({name:n.Classification||"Free category",value:a,id:r}))}return[]},t.prototype.getAttributes=function(t){if(!t)throw"entity must be defined";var e=[],i=t.Attributes;if(!i)return e;for(var r in i){var n=i[r];e.push(new s.xVisualAttribute({name:n.Name,description:n.Description,value:this.getValueString(n),propertySet:n.ExternalEntity,categories:this.getCategoryProperties(n),issues:n.Issues?this.getIssues({Issues:n.Issues}):[]}))}return e},t.prototype.getAssignments=function(t,e){if(!t||!e)throw"entity and type must be defined";var i=this.getTranslator(),r=[];for(var n in t)if(t.hasOwnProperty(n)){var a=new o.xVisualAssignmentSet,s=t[n];if(s instanceof Array&&s.length>0&&"undefined"!=typeof s[0].KeyType){a.id=s[0].KeyType,a.name=i(n);for(var u=0;u<s.length;u++){if("Contact"===s[u].KeyType){var l=this.findContact(s.Email);if(l){a.assignments.push(l);continue}}var A=this.getVisualEntity(s[u],s[u].KeyType.toLowerCase());A.isKey=!0,a.assignments.push(A)}r.push(a)}else if("undefined"==typeof s.KeyType)if(s instanceof Array||!(s instanceof Object));else{a.id=s.KeyType,a.name=i(n);var c=this.getVisualEntity(s,"inner");a.assignments.push(c),r.push(a)}else{if(a.id=s.KeyType,a.name=i(n),"Contact"===s.KeyType&&this._contacts){var l=this.findContact(s.Email);if(l){a.assignments.push(l),r.push(a);continue}}var c=this.getVisualEntity(s,s.KeyType.toLowerCase());a.assignments.push(c),r.push(a)}}return r},t.prototype.findContact=function(t){for(var e=0;e<this._contacts.length;e++){var i=this._contacts[e],r=i.properties.filter(function(t){return"Email"===t.name})[0];if(r&&r.value===t)return i}},t.prototype.getDocuments=function(t,e){if(!t||!e)throw"entity and type must be defined";var i=[],r=t.Documents;if(!r)return i;for(var n=0;n<r.length;n++){var a=r[n],o=this.getVisualEntity(a,"document");i.push(o)}return i},t.prototype.getIssues=function(t){if(!t)throw"entity and type must be defined";var e=[],i=t.Issues;if(!i)return e;for(var r=0;r<i.length;r++){var n=i[r],a=this.getVisualEntity(n,"issue");e.push(a)}return e},t.prototype.setLanguage=function(t,e){this._dictionary=new a.xAttributeDictionary(t,e)},t.prototype.getValueString=function(t){if("undefined"==typeof t||null==t)return"";var e=t.Unit||"";if("undefined"!=typeof t.StringAttributeValue)return t.StringAttributeValue.Value||"";if("undefined"!=typeof t.BooleanAttributeValue)return t.BooleanAttributeValue.Value||"";if("undefined"!=typeof t.DateTimeAttributeValue)return t.DateTimeAttributeValue.Value||"";if("undefined"!=typeof t.DecimalAttributeValue){var i=t.DecimalAttributeValue.Value;return i?(i=i.toFixed(this.settings.decimalPlaces),i.toString()+" "+e):""}if("undefined"!=typeof t.IntegerAttributeValue){var i=t.IntegerAttributeValue.Value;return i?i.toString()+" "+e:""}return"object"==typeof t?null:t},t.prototype.getTranslator=function(){var t=this;return function(e){return t._dictionary[e]?t._dictionary[e]:e.replace(/([a-z0-9])([A-Z])/g,"$1 $2")}},t}();e.xCobieUkUtils=l},function(t,e){"use strict";var i=function(){function t(t){if(this.id="",this.type="",this.name="",this.description="",this.attributes=[],this.properties=[],this.documents=[],this.issues=[],this.assignments=[],this.children=[],this.warranties=[],this.isKey=!1,"object"==typeof t)for(var e in t)this[e]=t[e]}return t}();e.xVisualEntity=i},function(t,e){"use strict";var i=function(){function t(){this.name="",this.id="",this.assignments=[]}return t}();e.xVisualAssignmentSet=i},function(t,e){"use strict";var i=function(){function t(t){if(this.name="",this.description="",this.value="",this.propertySet="",this.category="",this.issues=[],"object"==typeof t)for(var e in t)this[e]=t[e]}return t}();e.xVisualAttribute=i},function(t,e){"use strict";var i=function(){function t(t){if(this.name="",this.value="",this.id="","object"==typeof t)for(var e in t)this[e]=t[e]}return t}();e.xVisualProperty=i},function(t,e,i){"use strict";var r=i(25),n=i(23),a=i(20),o=i(26),s=i(27),u=i(28),l=function(){function t(t,e){this.settings={decimalPlaces:4},this._dictionary=new a.xAttributeDictionary(t,e)}return t.prototype.getVisualEntity=function(t,e){if(!t||!e)throw"entity must be defined";var i=t.externalID||t.externalIDReference,n="",a="";for(var o in t)if(t.hasOwnProperty(o)&&(o.toLowerCase()===(e+"name").toLowerCase()&&(n=t[o]),o.toLowerCase()===(e+"description").toLowerCase()&&(a=t[o]),0!==n.length&&0!==a.length))break;return new r.xVisualEntity({id:i,type:e,name:n,description:a,attributes:this.getAttributes(t),properties:this.getProperties(t),assignments:this.getAssignments(t,e),documents:this.getDocuments(t,e),issues:this.getIssues(t)})},t.prototype.getVisualModel=function(t){if(!t)throw"data must be defined";var e=this.getAssetTypes(t),i=this.getSpatialStructure(t,e);return new n.xVisualModel({facility:i,zones:this.getZones(t,i),systems:this.getSystems(t,e),assetTypes:e,contacts:this.getContacts(t)})},t.prototype.getContacts=function(t){if(!t)throw"data must be defined";var e=[],i=t.Contacts;return i&&(i=i.Contact),i?(i.forEach(function(t){var i=this.getVisualEntity(t,"contact");e.push(i)},this),e):e},t.prototype.getSpatialStructure=function(t,e){if(!t)throw"data must be defined";var i=this.getVisualEntity(t,"facility"),r=t.Floors;return r?(r=r.Floor,r&&0!=r.length?(r.forEach(function(t){var e=this.getVisualEntity(t,"floor");i.children.push(e);var r=t.Spaces;r&&(r=r.Space,r&&r.forEach(function(t){var i=this.getVisualEntity(t,"space");e.children.push(i)},this))},this),e=e?e:this.getAssetTypes(t),e.forEach(function(t){t.children.forEach(function(t){var e=t.assignments.filter(function(t){return"Space"===t.id})[0];if(e){var r=e.assignments[0];if(r){var n=r.properties.filter(function(t){return"SpaceName"===t.id})[0],a=r.properties.filter(function(t){return"FloorName"===t.id})[0];if(a&&n){var o=n.value,s=a.value,u=i.children.filter(function(t){return t.name===s})[0];if(u){var l=u.children.filter(function(t){return t.name===o})[0];l&&(l.children.push(t),e.assignments[0]=l)}}}}},this)},this),[i]):[i]):[i]},t.prototype.getZones=function(t,e){if(!t)throw"data must be defined";var i=[],r=t.Zones;return r&&(r=r.Zone)?(r.forEach(function(t){var e=this.getVisualEntity(t,"zone");i.push(e)},this),e.forEach(function(t){t.children.forEach(function(t){t.children.forEach(function(t){var e=t.assignments.filter(function(t){return"Zone"===t.id})[0];if(e){var r=e.assignments[0];if(r&&r.id){var n=i.filter(function(t){return t.id===r.id})[0];n&&(n.children.push(t),e.assignments[0]=n)}}},this)},this)},this),i):i},t.prototype.getSystems=function(t,e){if(!t)throw"data must be defined";var i=[],r=t.Systems;return r&&(r=r.System)?(r.forEach(function(t){var e=this.getVisualEntity(t,"system");i.push(e)},this),e=e?e:this.getAssetTypes(t),e.forEach(function(t){t.children.forEach(function(t){var e=t.assignments.filter(function(t){return"System"===t.id})[0];if(e){var r=e.assignments[0];if(r&&r.id){var n=i.filter(function(t){return t.id===r.id})[0];n&&(n.children.push(t),e.assignments[0]=n)}}},this)},this),i):i},t.prototype.getAssetTypes=function(t){if(!t)throw"data must be defined";var e=[],i=this.getTranslator(),r=t.AssetTypes;return r&&(r=r.AssetType)?(r.forEach(function(t){var r=this.getVisualEntity(t,"assettype");e.push(r);var n=t.Assets;n&&(n=n.Asset,n&&n.forEach(function(t){var e=this.getVisualEntity(t,"asset");r.children.push(e);var n=new o.xVisualAssignmentSet;n.id="AssetType",n.name=i(n.id),n.assignments.push(r),e.assignments.push(n)},this))},this),e):e},t.prototype.getProperties=function(t){if(!t)throw"entity must be defined";var e=this.getTranslator(),i=[];for(var r in t)if(t.hasOwnProperty(r)){var n=t[r],a=this.getValueString(n);if(a){var o=e(r);i.push(new u.xVisualProperty({name:o,value:a,id:r}))}}return i},t.prototype.getAttributes=function(t){if(!t)throw"entity must be defined";var e=[],i=null;for(var r in t)if(t.hasOwnProperty(r)&&t[r].Attribute){i=t[r].Attribute;break}return i?(i.forEach(function(t){e.push(new s.xVisualAttribute({name:t.AttributeName,description:t.AttributeDescription,value:this.getValueString(t.AttributeValue),propertySet:t.propertySetName,category:t.AttributeCategory,issues:t.AttributeIssues?this.getAttributes(t.AttributeIssues):[]}))},this),e):e},t.prototype.getAssignments=function(t,e){if(!t||!e)throw"entity and type must be defined";var i=this.getTranslator(),r=[];for(var n in t)if(t.hasOwnProperty(n)){var a=new o.xVisualAssignmentSet,s=new RegExp("^("+e+")(.*)(assignments)$","i");if(s.test(n)){a.id=n.replace(s,"$2"),a.name=i(a.id+"s");for(var u in t[n])if(t[n].hasOwnProperty(u)){var l=t[n][u],A=u.replace("Assignment","").toLowerCase();for(var u in l)if(l.hasOwnProperty(u)){var c=l[u],h=this.getVisualEntity(c,A);h.isKey=!0,a.assignments.push(h)}}}if(s=new RegExp("(.*)(assignment)$","i"),s.test(n)){a.id=n.replace(s,"$1"),a.name=i(a.id);var f=this.getVisualEntity(t[n],a.id.toLowerCase());a.assignments.push(f)}0!==a.assignments.length&&r.push(a)}return r},t.prototype.getDocuments=function(t,e){if(!t||!e)throw"entity and type must be defined";var i=[];for(var r in t)if(t.hasOwnProperty(r)){var n=new RegExp("^("+e+")(documents)$","i");if(n.test(r)){var a=t[r].Document;if(!a)continue;for(var o=0;o<a.length;o++){var s=a[o],u=this.getVisualEntity(s,"document");i.push(u)}}}return i},t.prototype.getIssues=function(t){if(!t)throw"entity and type must be defined";var e=[];for(var i in t)if(t.hasOwnProperty(i)&&t[i].Issue)for(var r=t[i].Issue,n=0;n<r.length;n++){var a=r[n],o=this.getVisualEntity(a,"issue");e.push(o)}return e},t.prototype.setLanguage=function(t,e){this._dictionary=new a.xAttributeDictionary(t,e)},t.prototype.getValueString=function(t){if("undefined"==typeof t||null==t)return"";var e=this.getTranslator();"undefined"!=typeof t.Item&&(t=t.Item),"undefined"!=typeof t.AttributeBooleanValue&&(t=t.AttributeBooleanValue),"undefined"!=typeof t.AttributeDateValue&&(t=t.AttributeDateValue),"undefined"!=typeof t.AttributeDateTimeValue&&(t=t.AttributeDateTimeValue),"undefined"!=typeof t.AttributeDecimalValue&&(t=t.AttributeDecimalValue),"undefined"!=typeof t.AttributeIntegerValue&&(t=t.AttributeIntegerValue),"undefined"!=typeof t.AttributeMonetaryValue&&(t=t.AttributeMonetaryValue),"undefined"!=typeof t.AttributeStringValue&&(t=t.AttributeStringValue),"undefined"!=typeof t.AttributeTimeValue&&(t=t.AttributeTimeValue);var i="";return"string"==typeof t&&(i=t),"undefined"!=typeof t.BooleanValue&&(i=e(t.BooleanValue?"True":"False")),"undefined"!=typeof t.StringValue&&(i=t.StringValue),"undefined"!=typeof t.DecimalValue&&(i=t.DecimalValue.toFixed(this.settings.decimalPlaces).toString()),"undefined"!=typeof t.IntegerValue&&(i=t.IntegerValue.toString()),t.UnitName&&(i+=" "+t.UnitName),i.length>0?i:""},t.prototype.getTranslator=function(){var t=this;return function(e){return t._dictionary[e]?t._dictionary[e]:e.replace(/([a-z0-9])([A-Z])/g,"$1 $2")}},t}();e.xCobieUtils=l},function(t,e){}]);
//# sourceMappingURL=xbim.bundle.min.js.map